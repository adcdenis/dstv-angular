import{j as oe,n as ne}from"./chunk-ZUE3IRRM.js";import{a as ce}from"./chunk-ZG7MC6PH.js";import{a as z}from"./chunk-U6KA5TMW.js";import{a as q}from"./chunk-FURQSZNK.js";import{a as Y}from"./chunk-TYLBSFVV.js";import{a as te,b as ie}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import{a as Z,k as ee}from"./chunk-KFGHBMQI.js";import"./chunk-MZURXKLX.js";import"./chunk-XCSSQDET.js";import"./chunk-V5XYQFDX.js";import"./chunk-3AW6TXZQ.js";import"./chunk-LJGI4ZRP.js";import"./chunk-T2PIK6R3.js";import"./chunk-SFTIWTHH.js";import"./chunk-7SPUUUGD.js";import{h as W,i as J}from"./chunk-WSIWJYJX.js";import"./chunk-NJPLBFLS.js";import"./chunk-MDZH7E7N.js";import"./chunk-V6X5IB37.js";import"./chunk-3GJN2BSD.js";import"./chunk-MBI4S36B.js";import"./chunk-6LXUGSQP.js";import{a as K,b as Q}from"./chunk-UGHG6TU3.js";import"./chunk-UAXJ67OE.js";import{b as N,e as j,f as B,h as A,i as L,j as H,m as G,o as X}from"./chunk-KLIUDW4T.js";import"./chunk-S35HUXPS.js";import{b as $,d as U}from"./chunk-4B2QLF32.js";import{k as S,p as k,s as I,t as V}from"./chunk-BFP4OEA6.js";import{$a as O,Aa as M,Bb as T,F as x,Ka as r,La as g,Ma as p,Ra as D,Tb as E,Y as s,Z as u,bb as F,da as P,ea as b,ja as _,ma as f,qa as w,sa as o,ta as i,tb as R,ua as c,yb as h,za as v}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{f as me}from"./chunk-MG3ERZGY.js";var ae=me(ce());function pe(l,C){l&1&&(o(0,"tr")(1,"th"),r(2,"Nome"),i(),o(3,"th"),r(4,"Usu\xE1rio"),i(),o(5,"th"),r(6,"Data Vencimento"),i(),o(7,"th"),r(8,"Plano"),i(),o(9,"th"),r(10,"Servidor"),i(),o(11,"th"),r(12,"Status"),i()())}function ue(l,C){if(l&1&&(o(0,"tr")(1,"td")(2,"span",44),r(3,"Nome"),i(),r(4),i(),o(5,"td")(6,"span",44),r(7,"Usu\xE1rio"),i(),r(8),i(),o(9,"td")(10,"span",44),r(11,"Data Vencimento"),i(),r(12),O(13,"date"),i(),o(14,"td")(15,"span",44),r(16,"Plano"),i(),r(17),i(),o(18,"td")(19,"span",44),r(20,"Servidor"),i(),r(21),i(),o(22,"td")(23,"span",44),r(24,"Status"),i(),o(25,"span"),r(26),i()()()),l&2){let e=C.$implicit,t=M();s(4),p(" ",e.nome," "),s(4),p(" ",e.usuario||"-"," "),s(4),p(" ",F(13,8,e.dataVencimento,"dd/MM/yyyy")," "),s(5),p(" ",(e.plano==null?null:e.plano.nome)||"-"," "),s(4),p(" ",(e.servidor==null?null:e.servidor.nome)||"-"," "),s(4),w("status-badge "+t.getStatusClass(e.dataVencimento)),s(),p(" ",t.getStatusCliente(e.dataVencimento)," ")}}function fe(l,C){l&1&&(o(0,"tr")(1,"td",45),r(2," Nenhum cliente encontrado com os filtros selecionados. "),i()())}function ve(l,C){if(l&1&&(o(0,"div",46)(1,"small",30),r(2),i()()),l&2){let e=M();s(2),p(" Mostrando os primeiros 10 registros de ",e.clientesFiltrados.length,'. Clique em "Gerar Excel" para exportar todos os dados. ')}}var le=(()=>{class l{constructor(e,t,n,a,d,y){this.formBuilder=e,this.clienteService=t,this.planoService=n,this.servidorService=a,this.messageService=d,this.datePipe=y,this.listaClientes=[],this.listaPlanos=[],this.listaServidores=[],this.clientesFiltrados=[],this.statusOptions=[],this.cols=[],this.filtroForm=this.formBuilder.group({nomeCliente:[""],plano:[""],servidor:[""],status:["ativos"]}),this.statusOptions=[{label:"Ativos",value:"ativos"},{label:"Vencidos",value:"vencidos"},{label:"Todos",value:"todos"},{label:"Vence em 3 dias",value:"vence3dias"}],this.cols=[{field:"nome",header:"Nome"},{field:"usuario",header:"Usu\xE1rio"},{field:"dataVencimento",header:"Data Vencimento"},{field:"plano",header:"Plano"},{field:"servidor",header:"Servidor"},{field:"status",header:"Status"}]}ngOnInit(){this.carregarDados(),this.aplicarFiltros()}carregarDados(){this.clienteService.getAll().subscribe({next:e=>{this.listaClientes=this.converterDatas(e),this.clientesFiltrados=[...this.listaClientes]},error:e=>console.error("Erro ao carregar clientes:",e)}),this.planoService.getAll().subscribe({next:e=>{this.listaPlanos=e},error:e=>console.error("Erro ao carregar planos:",e)}),this.servidorService.getAll().subscribe({next:e=>{this.listaServidores=e},error:e=>console.error("Erro ao carregar servidores:",e)})}converterDatas(e){return e.map(t=>{let n=t.dataVencimento;if(n&&n.seconds){let a=new Date(n.seconds*1e3);t.dataVencimento=a}return t})}aplicarFiltros(){let e=this.filtroForm.value,t=[...this.listaClientes];e.nomeCliente&&(t=t.filter(a=>a.nome?.toLowerCase().includes(e.nomeCliente.toLowerCase()))),e.plano&&(t=t.filter(a=>a.plano?.id===e.plano.id)),e.servidor&&(t=t.filter(a=>a.servidor?.id===e.servidor.id));let n=new Date;switch(n.setHours(0,0,0,0),e.status){case"ativos":t=t.filter(d=>d.dataVencimento>=n);break;case"vencidos":t=t.filter(d=>d.dataVencimento<n);break;case"vence3dias":let a=new Date;a.setHours(0,0,0,0),a.setDate(a.getDate()+3),t=t.filter(d=>d.dataVencimento>=n&&d.dataVencimento<=a);break;case"todos":break}this.clientesFiltrados=t}limparFiltros(){this.filtroForm.patchValue({nomeCliente:"",plano:"",servidor:"",status:"ativos"}),this.aplicarFiltros()}gerarExcel(){if(this.clientesFiltrados.length===0){this.messageService.add({severity:"warn",summary:"Aviso",detail:"N\xE3o h\xE1 dados para exportar com os filtros selecionados.",life:3e3});return}let e=this.clientesFiltrados.map(m=>({Nome:m.nome||"",Usu\u00E1rio:m.usuario||"",Email:m.email||"",Telefone:m.telefone||"","Data Vencimento":this.formatarData(m.dataVencimento),Plano:m.plano?.nome||"","Valor Plano":m.plano?.valor?`R$ ${m.plano.valor.toFixed(2)}`:"",Servidor:m.servidor?.nome||"",Observa\u00E7\u00E3o:m.observacao||"",Status:this.getStatusCliente(m.dataVencimento)})),t=ne.json_to_sheet(e),n=[{wch:30},{wch:20},{wch:30},{wch:20},{wch:15},{wch:20},{wch:15},{wch:25},{wch:40},{wch:15}];t["!cols"]=n;let d=oe({Sheets:{"Relat\xF3rio de Clientes":t},SheetNames:["Relat\xF3rio de Clientes"]},{bookType:"xlsx",type:"array"}),de=`relatorio-clientes-${new Date().toLocaleDateString("pt-BR").replace(/\//g,"-")}.xlsx`;ae.saveAs(new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),de),this.messageService.add({severity:"success",summary:"Sucesso",detail:`Relat\xF3rio gerado com ${this.clientesFiltrados.length} registros.`,life:3e3})}formatarData(e){return this.datePipe.transform(e,"dd/MM/yyyy")||""}getStatusCliente(e){let t=new Date;if(t.setHours(0,0,0,0),e<t)return"Vencido";if(e.getTime()===t.getTime())return"Vence Hoje";{let n=Math.ceil((e.getTime()-t.getTime())/864e5);return n<=3?`Vence em ${n} dia(s)`:"Ativo"}}getCountByStatus(e){let t=new Date;t.setHours(0,0,0,0);let n=[...this.listaClientes];switch(e){case"ativos":n=n.filter(d=>d.dataVencimento>=t);break;case"vencidos":n=n.filter(d=>d.dataVencimento<t);break;case"vence3dias":let a=new Date;a.setHours(0,0,0,0),a.setDate(a.getDate()+3),n=n.filter(d=>d.dataVencimento>=t&&d.dataVencimento<=a);break;default:return 0}return n.length}getStatusClass(e){let t=new Date;return t.setHours(0,0,0,0),e<t?"status-vencido":e.getTime()===t.getTime()?"status-vence-hoje":Math.ceil((e.getTime()-t.getTime())/864e5)<=3?"status-vence-3dias":"status-ativo"}static{this.\u0275fac=function(t){return new(t||l)(u(G),u(Y),u(q),u(z),u(S),u(h))}}static{this.\u0275cmp=P({type:l,selectors:[["app-relatorios"]],standalone:!1,features:[D([S])],decls:84,vars:16,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6","fade-in"],[1,"flex","align-items-center","justify-content-between","mb-4"],[1,"m-0"],[1,"pi","pi-file-excel","mr-2"],[1,"card","mb-4","filtro-card"],[1,"mb-3"],[1,"pi","pi-filter","mr-2"],[1,"p-fluid",3,"formGroup"],[1,"field","col-12","md:col-6","lg:col-3"],["for","nomeCliente"],["pInputText","","id","nomeCliente","formControlName","nomeCliente","placeholder","Digite o nome do cliente",3,"input"],["for","plano"],["id","plano","formControlName","plano","placeholder","Selecione um plano","optionLabel","nome",3,"onChange","options","showClear"],["for","servidor"],["id","servidor","formControlName","servidor","placeholder","Selecione um servidor","optionLabel","nome",3,"onChange","options","showClear"],["for","status"],["id","status","formControlName","status","optionLabel","label","optionValue","value",3,"onChange","options"],[1,"field","col-12"],[1,"flex","gap-2"],["pButton","","pRipple","","label","Limpar Filtros","icon","pi pi-filter-slash",1,"p-button-outlined","p-button-secondary",3,"click"],["pButton","","pRipple","","label","Gerar Excel","icon","pi pi-file-excel",1,"p-button-success",3,"click"],[1,"grid","mb-4"],[1,"col-12","md:col-6","lg:col-3"],[1,"card","summary-card"],[1,"flex","align-items-center"],[1,"p-3","bg-blue-100","border-round","mr-3"],[1,"pi","pi-users","text-blue-600","text-xl"],[1,"text-900","font-medium","text-xl"],[1,"text-600"],[1,"p-3","bg-green-100","border-round","mr-3"],[1,"pi","pi-check-circle","text-green-600","text-xl"],[1,"p-3","bg-orange-100","border-round","mr-3"],[1,"pi","pi-exclamation-triangle","text-orange-600","text-xl"],[1,"p-3","bg-yellow-100","border-round","mr-3"],[1,"pi","pi-clock","text-yellow-600","text-xl"],[1,"card"],[1,"pi","pi-eye","mr-2"],["styleClass","p-datatable-striped relatorios-table","responsiveLayout","stack","currentPageReportTemplate","Mostrando {first} at\xE9 {last} de {totalRecords} registros",3,"value","columns","rows","paginator","showCurrentPageReport"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["class","mt-3 text-center",4,"ngIf"],[1,"p-column-title"],["colspan","6",1,"text-center"],[1,"mt-3","text-center"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),c(3,"p-toast"),o(4,"div",3)(5,"h5",4),c(6,"i",5),r(7,"Relat\xF3rios de Clientes"),i()(),o(8,"div",6)(9,"h6",7),c(10,"i",8),r(11,"Filtros"),i(),o(12,"form",9)(13,"div",0)(14,"div",10)(15,"label",11),r(16,"Nome do Cliente"),i(),o(17,"input",12),v("input",function(){return n.aplicarFiltros()}),i()(),o(18,"div",10)(19,"label",13),r(20,"Plano"),i(),o(21,"p-dropdown",14),v("onChange",function(){return n.aplicarFiltros()}),i()(),o(22,"div",10)(23,"label",15),r(24,"Servidor"),i(),o(25,"p-dropdown",16),v("onChange",function(){return n.aplicarFiltros()}),i()(),o(26,"div",10)(27,"label",17),r(28,"Status"),i(),o(29,"p-dropdown",18),v("onChange",function(){return n.aplicarFiltros()}),i()(),o(30,"div",19)(31,"div",20)(32,"button",21),v("click",function(){return n.limparFiltros()}),i(),o(33,"button",22),v("click",function(){return n.gerarExcel()}),i()()()()()(),o(34,"div",23)(35,"div",24)(36,"div",25)(37,"div",26)(38,"div",27),c(39,"i",28),i(),o(40,"div")(41,"div",29),r(42),i(),o(43,"div",30),r(44,"Total Filtrado"),i()()()()(),o(45,"div",24)(46,"div",25)(47,"div",26)(48,"div",31),c(49,"i",32),i(),o(50,"div")(51,"div",29),r(52),i(),o(53,"div",30),r(54,"Ativos"),i()()()()(),o(55,"div",24)(56,"div",25)(57,"div",26)(58,"div",33),c(59,"i",34),i(),o(60,"div")(61,"div",29),r(62),i(),o(63,"div",30),r(64,"Vencidos"),i()()()()(),o(65,"div",24)(66,"div",25)(67,"div",26)(68,"div",35),c(69,"i",36),i(),o(70,"div")(71,"div",29),r(72),i(),o(73,"div",30),r(74,"Vencem em 3 dias"),i()()()()()(),o(75,"div",37)(76,"h6",7),c(77,"i",38),r(78,"Pr\xE9-visualiza\xE7\xE3o dos Dados"),i(),o(79,"p-table",39),_(80,pe,13,0,"ng-template",40)(81,ue,27,11,"ng-template",41)(82,fe,3,0,"ng-template",42),i(),_(83,ve,3,1,"div",43),i()()()()),t&2&&(s(12),f("formGroup",n.filtroForm),s(9),f("options",n.listaPlanos)("showClear",!0),s(4),f("options",n.listaServidores)("showClear",!0),s(4),f("options",n.statusOptions),s(13),g(n.clientesFiltrados.length),s(10),g(n.getCountByStatus("ativos")),s(10),g(n.getCountByStatus("vencidos")),s(10),g(n.getCountByStatus("vence3dias")),s(7),f("value",n.clientesFiltrados.slice(0,10))("columns",n.cols)("rows",10)("paginator",!1)("showCurrentPageReport",!1),s(4),f("ngIf",n.clientesFiltrados.length>10))},dependencies:[R,A,N,j,B,L,H,$,k,W,K,Z,te,I,h],styles:[".filtro-card[_ngcontent-%COMP%]{background-color:var(--surface-card);border:1px solid var(--surface-border);border-radius:14px;padding:1.5rem}.filtro-card[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{margin-bottom:1rem}.summary-card[_ngcontent-%COMP%]{background-color:var(--surface-card);border:1px solid var(--surface-border);border-radius:14px;padding:1rem;transition:all .3s ease}.summary-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.status-badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:50px;font-size:.875rem;font-weight:600}.status-badge.status-ativo[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.status-badge.status-vencido[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.status-badge.status-vence-hoje[_ngcontent-%COMP%], .status-badge.status-vence-3dias[_ngcontent-%COMP%]{background-color:#fff3cd;color:#856404}.relatorios-table[_ngcontent-%COMP%]   .p-datatable-thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]{background-color:var(--surface-section);font-weight:600;color:var(--text-color);border-bottom:2px solid var(--surface-border)}.relatorios-table[_ngcontent-%COMP%]   .p-datatable-tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]{transition:background-color .2s ease}.relatorios-table[_ngcontent-%COMP%]   .p-datatable-tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover)}.relatorios-table[_ngcontent-%COMP%]   .p-datatable-tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{padding:.75rem 1rem;border-bottom:1px solid var(--surface-border)}@media (max-width: 768px){.filtro-card[_ngcontent-%COMP%]{padding:1rem}.summary-card[_ngcontent-%COMP%]{margin-bottom:1rem}.summary-card[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{flex-direction:column;text-align:center}.summary-card[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]   .p-3[_ngcontent-%COMP%]{margin-right:0;margin-bottom:.5rem}}.fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}[_nghost-%COMP%]{position:relative;min-height:100vh}"]})}}return l})();var se=(()=>{class l{static{this.\u0275fac=function(t){return new(t||l)}}static{this.\u0275mod=b({type:l})}static{this.\u0275inj=x({imports:[E.forChild([{path:"",component:le}]),E]})}}return l})();var Ue=(()=>{class l{static{this.\u0275fac=function(t){return new(t||l)}}static{this.\u0275mod=b({type:l})}static{this.\u0275inj=x({providers:[h],imports:[T,se,X,U,J,Q,ee,ie,V]})}}return l})();export{Ue as RelatoriosModule};
