import{a as ce,b as de,c as pe}from"./chunk-3MEU6QOA.js";import{a as le}from"./chunk-I6AVHS5N.js";import{a as N,b as ie}from"./chunk-QD3EWCKC.js";import{a as se}from"./chunk-TYJRV2V5.js";import{a as O}from"./chunk-AW5DFX2W.js";import{a as P}from"./chunk-ULMLR6ZN.js";import{a as j}from"./chunk-77VZTUG6.js";import{b as re}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import{k as ae}from"./chunk-C3W5HSCK.js";import"./chunk-5CO6IPWY.js";import"./chunk-UNGKZQU4.js";import"./chunk-4RURM2DY.js";import"./chunk-UHPR5IVD.js";import"./chunk-T2PIK6R3.js";import"./chunk-7SPUUUGD.js";import"./chunk-SFTIWTHH.js";import{h as oe,i as ne}from"./chunk-VPFJ3TVV.js";import"./chunk-NJPLBFLS.js";import"./chunk-MDZH7E7N.js";import"./chunk-V6X5IB37.js";import"./chunk-V5XYQFDX.js";import"./chunk-3GJN2BSD.js";import"./chunk-UW4E5NSV.js";import"./chunk-6LXUGSQP.js";import"./chunk-RD2ZW53S.js";import"./chunk-UAXJ67OE.js";import{e as X,g as $,m as ee}from"./chunk-ENZ5W56S.js";import"./chunk-S35HUXPS.js";import{d as te}from"./chunk-4B2QLF32.js";import"./chunk-BFP4OEA6.js";import{$a as L,Aa as E,Bb as Q,F as w,Ka as l,La as S,Ma as H,Na as J,Oa as G,Pa as Z,Qa as q,Tb as k,Y as c,Z as u,bb as _,da as D,ea as F,hb as A,ja as x,ma as d,sa as r,sb as K,ta as a,tb as R,ua as p,za as U,zb as T}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import"./chunk-MG3ERZGY.js";function Ee(n,v){n&1&&(r(0,"div",21),p(1,"i",22),a())}function Le(n,v){if(n&1&&(r(0,"div",23),p(1,"p-chart",24),a()),n&2){let t=E();c(),d("data",t.chartData)("options",t.chartOptions)}}function _e(n,v){n&1&&(r(0,"div",25),l(1," Nenhum dado encontrado para o ano selecionado. "),a())}var me=(()=>{class n{constructor(t,o,e,i,m){this.clienteService=t,this.planoService=o,this.servidorService=e,this.historicoService=i,this.cdr=m,this.lucroTotalAnual=0,this.isLoading=!0,this.anosDisponiveis=[],this.anoSelecionado=new Date().getFullYear(),this.clientes=[],this.planos=[],this.servidores=[],this.historico=[],this.lucroMensal=[]}ngOnInit(){this.carregarDados()}carregarDados(){this.isLoading=!0,this.clienteService.getAll().subscribe(t=>{this.clientes=t||[],this.planoService.getAll().subscribe(o=>{this.planos=o||[],this.servidorService.getAll().subscribe(e=>{this.servidores=e||[],this.historicoService.getAll().subscribe(i=>{this.historico=i||[],this.processarDados(),this.initChartOptions(),this.isLoading=!1,this.cdr.detectChanges()},i=>{console.error("Erro ao carregar hist\xF3rico:",i),this.isLoading=!1,this.cdr.detectChanges()})},e=>{console.error("Erro ao carregar servidores:",e),this.isLoading=!1,this.cdr.detectChanges()})},o=>{console.error("Erro ao carregar planos:",o),this.isLoading=!1,this.cdr.detectChanges()})},t=>{console.error("Erro ao carregar clientes:",t),this.isLoading=!1,this.cdr.detectChanges()})}processarDados(){let t=new Set,o=new Date().getFullYear();t.add(o),this.historico.forEach(e=>{if(e.dataHoraRenovacao){let i;if(typeof e.dataHoraRenovacao=="object"&&e.dataHoraRenovacao!==null&&"seconds"in e.dataHoraRenovacao){let m=e.dataHoraRenovacao;i=new Date(m.seconds*1e3)}else i=new Date(e.dataHoraRenovacao);isNaN(i.getTime())||t.add(i.getFullYear())}}),this.anosDisponiveis=Array.from(t).sort((e,i)=>i-e),this.anosDisponiveis.includes(o)||this.anosDisponiveis.unshift(o),this.calcularLucroMensal()}calcularLucroMensal(){this.lucroMensal=[],this.lucroTotalAnual=0,console.log("=== IN\xCDCIO C\xC1LCULO LUCRO MENSAL ==="),console.log("Ano selecionado:",this.anoSelecionado);let t=["Janeiro","Fevereiro","Mar\xE7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];for(let i=0;i<12;i++)this.lucroMensal.push({mes:t[i],valor:0});let o=new Map;this.planos.forEach(i=>{i.id&&o.set(i.id,i)});let e=new Map;this.servidores.forEach(i=>{i.id&&e.set(i.id,i)}),this.historico.forEach((i,m)=>{if(i.dataHoraRenovacao&&i.plano?.id&&i.servidor?.id){let h;if(typeof i.dataHoraRenovacao=="object"&&i.dataHoraRenovacao!==null&&"seconds"in i.dataHoraRenovacao){let g=i.dataHoraRenovacao;h=new Date(g.seconds*1e3)}else h=new Date(i.dataHoraRenovacao);if(!isNaN(h.getTime())&&h.getFullYear()===this.anoSelecionado){let g=o.get(i.plano.id),C=e.get(i.servidor.id);if(g&&C){let B=g.valor||0,I=C.valorCredito||0,y=B-I,s=h.getMonth();this.lucroMensal[s].valor+=y,this.lucroTotalAnual+=y}}}}),this.chartData={labels:this.lucroMensal.map(i=>i.mes),datasets:[{label:"Lucro Mensal",data:this.lucroMensal.map(i=>i.valor),backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]}}onAnoChange(){this.calcularLucroMensal(),this.cdr.detectChanges()}initChartOptions(){this.chartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{color:"#495057",font:{size:14}}},tooltip:{callbacks:{label:function(t){let o=t.dataset.label||"";return o&&(o+=": "),t.parsed.y!==null&&(o+=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.parsed.y)),o}}}},scales:{x:{ticks:{color:"#495057",font:{size:12}},grid:{color:"#ebedef",display:!1}},y:{beginAtZero:!0,ticks:{color:"#495057",font:{size:12},callback:function(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)}},grid:{color:"#ebedef"}}}}}static{this.\u0275fac=function(o){return new(o||n)(u(j),u(P),u(O),u(se),u(A))}}static{this.\u0275cmp=D({type:n,selectors:[["app-lucro-mensal"]],standalone:!1,decls:32,vars:11,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6","fade-in"],[1,"m-0","mb-4"],[1,"pi","pi-chart-bar","mr-2"],[1,"card","mb-4",2,"position","relative","z-index","1"],[1,"flex","align-items-center","gap-3"],["for","anoSelect",1,"text-900","font-medium"],["id","anoSelect","placeholder","Selecione o ano","appendTo","body",1,"w-12rem",3,"ngModelChange","onChange","options","ngModel"],[1,"text-600","text-sm"],[1,"card"],["class","flex justify-content-center p-5",4,"ngIf"],["style","height: 400px;",4,"ngIf"],["class","text-center text-500 p-5",4,"ngIf"],[1,"col-12","mt-4"],[1,"card","flex","flex-column","align-items-center","justify-content-center","bg-green-50","surface-overlay","border-round","shadow-2"],[1,"flex","align-items-center","justify-content-center","bg-green-100","border-circle","p-3","mb-3"],[1,"pi","pi-money-bill","text-5xl","text-green-600"],[1,"text-xl","text-600","font-medium","mb-2"],[1,"text-4xl","font-bold","text-900"],[1,"text-sm","text-500","mt-3","text-center","px-3"],[1,"flex","justify-content-center","p-5"],[1,"pi","pi-spin","pi-spinner","text-4xl"],[2,"height","400px"],["type","bar",3,"data","options"],[1,"text-center","text-500","p-5"]],template:function(o,e){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),p(4,"i",4),l(5,"Finan\xE7as - Lucro Mensal"),a(),r(6,"div",5)(7,"div",6)(8,"label",7),l(9,"Ano:"),a(),r(10,"p-dropdown",8),q("ngModelChange",function(m){return Z(e.anoSelecionado,m)||(e.anoSelecionado=m),m}),U("onChange",function(){return e.onAnoChange()}),a(),r(11,"span",9),l(12,"Selecione o ano para visualizar o lucro mensal"),a()()(),r(13,"div",0)(14,"div",1)(15,"div",10)(16,"h5"),l(17),a(),x(18,Ee,2,0,"div",11)(19,Le,2,2,"div",12)(20,_e,2,0,"div",13),a()()(),r(21,"div",14)(22,"div",15)(23,"div",16),p(24,"i",17),a(),r(25,"span",18),l(26),a(),r(27,"span",19),l(28),L(29,"currency"),a(),r(30,"span",20),l(31," Baseado nas renova\xE7\xF5es registradas no hist\xF3rico "),a()()()()()()),o&2&&(c(10),d("options",e.anosDisponiveis),G("ngModel",e.anoSelecionado),c(7),H("Lucro Mensal - ",e.anoSelecionado,""),c(),d("ngIf",e.isLoading),c(),d("ngIf",!e.isLoading&&e.chartData),c(),d("ngIf",!e.isLoading&&!e.chartData),c(6),H("Lucro Total Anual - ",e.anoSelecionado,""),c(2),S(_(29,8,e.lucroTotalAnual,"BRL")))},dependencies:[R,X,$,N,oe,T],styles:[".fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}[_nghost-%COMP%]{position:relative;min-height:100vh}.card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #0000001a}.bg-green-50[_ngcontent-%COMP%]{background-color:#f0fdf4!important}.bg-green-100[_ngcontent-%COMP%]{background-color:#dcfce7!important}.text-green-600[_ngcontent-%COMP%]{color:#16a34a!important}"]})}}return n})();function we(n,v){n&1&&(r(0,"div",26),p(1,"i",27),a())}function De(n,v){if(n&1&&p(0,"p-chart",28),n&2){let t=E();d("data",t.basicData)("options",t.basicOptions)}}function Fe(n,v){n&1&&(r(0,"div",26),p(1,"i",27),a())}function Ae(n,v){if(n&1&&(r(0,"div",30)(1,"div",31)(2,"div",32)(3,"span",33),l(4),a(),r(5,"span",34),l(6),a()(),r(7,"div",35)(8,"span",36),l(9,"Lucro Previsto:"),a(),r(10,"span",37),l(11),L(12,"currency"),a()()()()),n&2){let t=v.$implicit;c(4),S(t.servidor.nome),c(2),J(" ",t.clientesAtivos," ",t.clientesAtivos===1?"cliente":"clientes"," "),c(5),S(_(12,4,t.lucro,"BRL"))}}function Re(n,v){if(n&1&&(r(0,"div",0),x(1,Ae,13,7,"div",29),a()),n&2){let t=E();c(),d("ngForOf",t.estatisticasServidor)}}function Te(n,v){n&1&&(r(0,"div",38),l(1," Nenhum servidor com clientes ativos encontrado. "),a())}var fe=(()=>{class n{constructor(t,o,e,i){this.clienteService=t,this.planoService=o,this.servidorService=e,this.cdr=i,this.lucroTotal=0,this.isLoading=!0,this.clientes=[],this.planos=[],this.servidores=[],this.estatisticasServidor=[]}ngOnInit(){this.carregarDados()}carregarDados(){this.isLoading=!0,this.clienteService.getAll().subscribe(t=>{this.clientes=t||[],this.planoService.getAll().subscribe(o=>{this.planos=o||[],this.servidorService.getAll().subscribe(e=>{this.servidores=e||[],this.processarDados(this.clientes,this.planos,this.servidores),this.initChartOptions(),this.isLoading=!1,this.cdr.detectChanges()},e=>{console.error("Erro ao carregar servidores:",e),this.isLoading=!1,this.cdr.detectChanges()})},o=>{console.error("Erro ao carregar planos:",o),this.isLoading=!1,this.cdr.detectChanges()})},t=>{console.error("Erro ao carregar clientes:",t),this.isLoading=!1,this.cdr.detectChanges()})}processarDados(t,o,e){let i=new Map;o.forEach(s=>{s.id&&i.set(s.id,s)});let m=new Map;e.forEach(s=>{s.id&&m.set(s.id,s)});let h=new Map,g=new Map;e.forEach(s=>{s.id&&(h.set(s.id,0),g.set(s.id,0))}),this.lucroTotal=0;let C=new Date;C.setHours(0,0,0,0);let B=0;t.forEach(s=>{let f=s.dataVencimento;if(f?.seconds&&(f=new Date(f.seconds*1e3)),f instanceof Date||(f=new Date(f)),f.setHours(0,0,0,0),f>=C){B++;let M=s.plano?.id,b=s.servidor?.id;if(M&&b){let z=i.get(M),V=m.get(b);if(z&&V){let he=z.valor||0,ve=V.valorCredito||0,W=he-ve;this.lucroTotal+=W;let ge=h.get(b)||0;h.set(b,ge+W);let be=g.get(b)||0;g.set(b,be+1)}}}});let I=[],y=[];this.estatisticasServidor=[],e.forEach(s=>{if(s.id&&s.nome){let f=g.get(s.id)||0;if(f>0){I.push(s.nome);let M=h.get(s.id)||0;y.push(M),this.estatisticasServidor.push({servidor:s,lucro:M,clientesAtivos:f})}}}),this.basicData={labels:I,datasets:[{label:"Lucro por Servidor (R$)",data:y,backgroundColor:"#42A5F5",borderColor:"#1E88E5",borderWidth:1}]}}initChartOptions(){this.basicOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#495057"}},tooltip:{callbacks:{label:function(t){let o=t.dataset.label||"";return o&&(o+=": "),t.parsed.y!==null&&(o+=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.parsed.y)),o}}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057",callback:function(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)}},grid:{color:"#ebedef"}}}}}static{this.\u0275fac=function(o){return new(o||n)(u(j),u(P),u(O),u(A))}}static{this.\u0275cmp=D({type:n,selectors:[["app-financas"]],standalone:!1,decls:40,vars:9,consts:[[1,"grid"],[1,"col-12"],[1,"card","p-0","overflow-hidden","border-none","shadow-2"],[1,"p-4","bg-primary","text-white","flex","align-items-center","gap-3"],[1,"pi","pi-dollar","text-3xl"],[1,"text-2xl","font-bold","m-0","text-white"],[1,"m-0","text-primary-100","opacity-80"],["styleClass","p-4"],["header","Lucro Mensal","leftIcon","pi pi-chart-bar"],["header","Lucro Previsto (M\xEAs Atual)","leftIcon","pi pi-dollar"],[1,"col-12","lg:col-8"],[1,"card"],["class","flex justify-content-center p-5",4,"ngIf"],["type","bar","height","400px",3,"data","options",4,"ngIf"],[1,"col-12","lg:col-4"],[1,"card","flex","flex-column","align-items-center","justify-content-center","h-full","bg-blue-50","border-none","border-round-xl","p-6","shadow-1"],[1,"flex","align-items-center","justify-content-center","bg-white","border-circle","shadow-1","p-4","mb-4",2,"width","100px","height","100px"],[1,"pi","pi-money-bill","text-6xl","text-blue-600"],[1,"text-xl","text-700","font-semibold","mb-2"],[1,"text-5xl","font-bold","text-blue-900","mb-2"],[1,"p-2","bg-blue-100","text-blue-800","border-round-lg","font-medium"],[1,"col-12","mt-4"],[1,"mb-4"],[1,"pi","pi-server","mr-2"],["class","grid",4,"ngIf"],["class","text-center text-500 p-4",4,"ngIf"],[1,"flex","justify-content-center","p-5"],[1,"pi","pi-spin","pi-spinner","text-4xl"],["type","bar","height","400px",3,"data","options"],["class","col-12 md:col-6 lg:col-4",4,"ngFor","ngForOf"],[1,"col-12","md:col-6","lg:col-4"],[1,"p-3","border-1","surface-border","border-round","surface-card"],[1,"flex","justify-content-between","align-items-center","mb-3"],[1,"text-xl","font-semibold","text-900"],[1,"bg-blue-100","text-blue-800","text-xs","font-bold","mr-2","px-2.5","py-0.5","rounded"],[1,"flex","justify-content-between","align-items-center"],[1,"text-600"],[1,"text-xl","font-bold","text-green-600"],[1,"text-center","text-500","p-4"]],template:function(o,e){o&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),p(4,"i",4),r(5,"div")(6,"h1",5),l(7,"Gest\xE3o Financeira"),a(),r(8,"p",6),l(9,"Acompanhamento de lucros e previs\xF5es"),a()()(),r(10,"p-tabView",7)(11,"p-tabPanel",8),p(12,"app-lucro-mensal"),a(),r(13,"p-tabPanel",9)(14,"div",0)(15,"div",10)(16,"div",11)(17,"h5"),l(18,"Lucro por Servidor"),a(),x(19,we,2,0,"div",12)(20,De,1,2,"p-chart",13),a()(),r(21,"div",14)(22,"div",15)(23,"div",16),p(24,"i",17),a(),r(25,"span",18),l(26,"Lucro Total Previsto"),a(),r(27,"div",19),l(28),L(29,"currency"),a(),r(30,"div",20),l(31," Estimativa Mensal "),a()()()(),r(32,"div",21)(33,"div",11)(34,"h5",22),p(35,"i",23),l(36,"Estat\xEDsticas por Servidor"),a(),x(37,Fe,2,0,"div",12)(38,Re,2,1,"div",24)(39,Te,2,0,"div",25),a()()()()()()()),o&2&&(c(19),d("ngIf",e.isLoading),c(),d("ngIf",!e.isLoading&&e.basicData),c(8),S(_(29,6,e.lucroTotal,"BRL")),c(9),d("ngIf",e.isLoading),c(),d("ngIf",!e.isLoading&&e.estatisticasServidor.length>0),c(),d("ngIf",!e.isLoading&&e.estatisticasServidor.length===0))},dependencies:[K,R,N,de,ce,me,T],encapsulation:2})}}return n})();var je=[{path:"",component:fe}],ue=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=F({type:n})}static{this.\u0275inj=w({imports:[k.forChild(je),k]})}}return n})();var ot=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=F({type:n})}static{this.\u0275inj=w({imports:[Q,ue,ee,ie,le,re,ae,te,pe,ne]})}}return n})();export{ot as FinancasModule};
