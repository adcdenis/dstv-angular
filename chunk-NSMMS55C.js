import{a as $}from"./chunk-FURQSZNK.js";import{a as ce,b as de}from"./chunk-YOAYV4RA.js";import"./chunk-2JY635KS.js";import{b as be}from"./chunk-6BD7PSS4.js";import{b as ue}from"./chunk-5WWM3MYI.js";import"./chunk-WSDER2HD.js";import"./chunk-T6OX34SV.js";import{b as fe}from"./chunk-MSYTDTXD.js";import{b as K}from"./chunk-4CYYGYMS.js";import{a as Z}from"./chunk-TYLBSFVV.js";import{a as he,b as _e}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import{b as ge}from"./chunk-W22XDKEB.js";import"./chunk-4JDA26ZU.js";import{a as le,d as ae,e as re,h as se,i as pe,k as me}from"./chunk-ION2EUQK.js";import"./chunk-XCSSQDET.js";import"./chunk-V5XYQFDX.js";import"./chunk-MZURXKLX.js";import"./chunk-3AW6TXZQ.js";import{b as ne,c as oe}from"./chunk-LJGI4ZRP.js";import"./chunk-T2PIK6R3.js";import"./chunk-SFTIWTHH.js";import"./chunk-7SPUUUGD.js";import{i as ee}from"./chunk-WSIWJYJX.js";import"./chunk-NJPLBFLS.js";import"./chunk-MDZH7E7N.js";import"./chunk-V6X5IB37.js";import"./chunk-3GJN2BSD.js";import"./chunk-MBI4S36B.js";import"./chunk-6LXUGSQP.js";import{a as te,b as ie}from"./chunk-UGHG6TU3.js";import"./chunk-UAXJ67OE.js";import{b as G,e as H,g as Q,k as U,n as Y}from"./chunk-KLIUDW4T.js";import"./chunk-S35HUXPS.js";import{b as J,d as X}from"./chunk-4B2QLF32.js";import{k as T,p as z,s as L,t as q}from"./chunk-BFP4OEA6.js";import{Aa as _,Bb as j,F as w,Ja as O,Ka as a,L as m,La as V,M as c,Ma as M,Oa as C,Pa as x,Qa as v,Ra as W,Sa as S,Ta as F,Tb as B,Y as p,Z as y,da as R,ea as E,ja as b,ma as d,pa as k,rb as D,sa as o,ta as n,tb as A,ua as g,ya as P,za as h}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{a as N,h as I}from"./chunk-MG3ERZGY.js";var ye=()=>["valor","nome","id"],Ee=()=>[10,20,30],Se=()=>({width:"450px"}),Ce=()=>({"960px":"50vw","640px":"90vw"}),xe=i=>({"ng-invalid ng-dirty":i});function Me(i,f){if(i&1){let e=P();o(0,"div",25)(1,"h5",26),g(2,"i",27),a(3,"Gerenciar Planos"),n(),o(4,"span",28),g(5,"i",29),o(6,"input",30),h("input",function(t){m(e);let r=_(),u=O(5);return c(r.onGlobalFilter(u,t))}),n()()()}}function Te(i,f){i&1&&(o(0,"th",38),a(1,"Id "),g(2,"p-sortIcon",39),n())}function Ie(i,f){i&1&&(o(0,"tr")(1,"th",31),g(2,"p-tableHeaderCheckbox"),n(),b(3,Te,3,0,"th",32),o(4,"th",33),a(5,"Nome "),g(6,"p-sortIcon",34),n(),o(7,"th",35),a(8,"Valor "),g(9,"p-sortIcon",34),n(),o(10,"th",36),a(11,"Clientes "),g(12,"p-sortIcon",37),n(),g(13,"th"),n()),i&2&&(p(3),d("ngIf",!1))}function ke(i,f){if(i&1&&(o(0,"td")(1,"span",41),a(2,"Id"),n(),a(3),n()),i&2){let e=_().$implicit;p(3),M(" ",e.id," ")}}function Ve(i,f){if(i&1){let e=P();o(0,"tr")(1,"td"),g(2,"p-tableCheckbox",40),n(),b(3,ke,4,1,"td",23),o(4,"td")(5,"span",41),a(6,"Nome"),n(),a(7),n(),o(8,"td")(9,"span",41),a(10,"Valor"),n(),a(11),n(),o(12,"td",42)(13,"span",41),a(14,"Clientes"),n(),o(15,"span",43),a(16),n()(),o(17,"td")(18,"div",44)(19,"button",45),h("click",function(){let t=m(e).$implicit,r=_();return c(r.abrirDialogAlterar(t))}),n(),o(20,"button",46),h("click",function(){m(e);let t=_();return c(t.abrirDialogExcluirSelecionados())}),n()()()()}if(i&2){let e=f.$implicit,l=_();p(2),d("value",e),p(),d("ngIf",!1),p(4),M(" ",e.nome," "),p(4),M(" ",e.valor," "),p(5),V(l.getNumeroClientes(e.id))}}function Fe(i,f){i&1&&(o(0,"small",47),a(1,"Nome \xE9 obrigat\xF3rio."),n())}function Be(i,f){i&1&&(o(0,"small",47),a(1,"Valor \xE9 obrigat\xF3rio."),n())}function Ne(i,f){i&1&&(o(0,"span"),a(1,"Tem certeza que voc\xEA deseja excluir o plano selecionado?"),n())}function Re(i,f){if(i&1&&(o(0,"span"),a(1,"Tem certeza que voc\xEA deseja excluir os "),o(2,"b"),a(3),n(),a(4," planos selecionados? Todos ser\xE3o exclu\xEDdos."),n()),i&2){let e=_();p(3),V(e.listaPlanosSelecionados.length)}}function Oe(i,f){if(i&1){let e=P();o(0,"button",48),h("click",function(){m(e);let t=_();return c(t.dialogoExcluirSelecionados=!1)}),n(),o(1,"button",49),h("click",function(){m(e);let t=_();return c(t.excluirSelecionados())}),n()}}var Pe=(()=>{class i{constructor(e,l,t){this.planoService=e,this.messageService=l,this.clienteService=t,this.listaPlanos=[],this.listaPlanosSelecionados=[],this.dialogoPlano=!1,this.dialogoExcluirSelecionados=!1,this.planoSelecionado={},this.cols=[],this.submitted=!1,this.clientesPorPlano={}}ngOnInit(){console.log("aqui"),this.cols=[{field:"id",header:"Id"},{field:"nome",header:"Nome"},{field:"valor",header:"Valor"},{field:"nrClientes",header:"Clientes"}],this.planoService.getAll().subscribe({next:e=>{this.listaPlanos=e,this.carregarContagemClientes()},error:e=>console.error(e),complete:()=>console.info("complete")})}salvarOuAlterar(){if(this.submitted=!0,!this.planoSelecionado.nome||this.planoSelecionado.nome.trim().length==0){this.messageService.add({severity:"error",summary:"Erro!",detail:"Insira um nome!",life:3e3});return}this.planoSelecionado.id?this.alterar():this.salvar()}salvar(){this.planoService.create(this.planoSelecionado).then(()=>{this.dialogoPlano=!1,this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Plano Criado!",life:3e3}),this.planoService.getAll().subscribe({next:e=>{this.listaPlanos=e,this.carregarContagemClientes()},error:e=>console.error(e),complete:()=>console.info("complete")})})}abrirDialogAlterar(e){this.planoSelecionado=N({},e),this.submitted=!1,this.dialogoPlano=!0}alterar(){this.planoService.update(this.planoSelecionado).then(()=>{this.dialogoPlano=!1,this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Alterado!",life:3e3}),this.planoService.getAll().subscribe({next:e=>{this.listaPlanos=e,this.carregarContagemClientes()},error:e=>console.error(e),complete:()=>console.info("complete")})})}onGlobalFilter(e,l){e.filterGlobal(l.target.value,"contains")}novo(){this.dialogoPlano=!0,this.planoSelecionado={}}abrirDialogExcluirSelecionados(){if(!this.listaPlanosSelecionados||this.listaPlanosSelecionados.length===0){this.messageService.add({severity:"warn",summary:"Aten\xE7\xE3o!",detail:"Por favor, selecione pelo menos um plano para excluir.",life:3e3});return}this.dialogoExcluirSelecionados=!0}carregarContagemClientes(){return I(this,null,function*(){this.clientesPorPlano={};for(let e of this.listaPlanos)if(e.id){let t=(yield this.clienteService.getByPlano(e.id)).docs.map(r=>r.data());this.clientesPorPlano[e.id]=t.length,e.nrClientes=t.length}this.listaPlanos=[...this.listaPlanos]})}getNumeroClientes(e){return e&&this.clientesPorPlano[e]||0}excluirSelecionados(){return I(this,null,function*(){if(this.listaPlanosSelecionados){let e=[];for(let l of this.listaPlanosSelecionados){let r=(yield this.clienteService.getByPlano(l.id||"")).docs.map(u=>u.data());r.length>0&&e.push({plano:l,clientes:r})}if(e.length>0){let l=`Os seguintes planos n\xE3o podem ser exclu\xEDdos pois est\xE3o sendo utilizados por clientes:
`;e.forEach(t=>{let r=t.clientes.map(u=>u.nome).join(", ");l+=`
\u2022 ${t.plano.nome}: ${r}`}),this.messageService.add({severity:"error",summary:"Erro ao excluir!",detail:l,life:8e3}),this.dialogoExcluirSelecionados=!1;return}this.listaPlanosSelecionados.forEach(l=>{this.planoService.delete(l.id||"")}),this.dialogoExcluirSelecionados=!1,this.listaPlanosSelecionados=[],this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Planos Exclu\xEDdos",life:3e3}),this.planoService.getAll().subscribe({next:l=>{this.listaPlanos=l,this.carregarContagemClientes()},error:l=>console.error(l),complete:()=>console.info("complete")})}})}static{this.\u0275fac=function(l){return new(l||i)(y($),y(T),y(Z))}}static{this.\u0275cmp=R({type:i,selectors:[["app-plano"]],standalone:!1,features:[W([T])],decls:32,vars:39,consts:[["dt",""],[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6","fade-in","list-card"],["styleClass","p-datatable-striped list-table planos-table","responsiveLayout","stack","currentPageReportTemplate","Mostrando {first} at\xE9 {last} de {totalRecords} registros","selectionMode","multiple","dataKey","id",3,"selectionChange","value","columns","rows","globalFilterFields","paginator","rowsPerPageOptions","showCurrentPageReport","selection","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pButton","","pRipple","","icon","pi pi-plus",1,"p-button-rounded","p-button-success","fab",3,"click"],["header","Detalhes do Plano",1,"p-fluid",3,"visibleChange","visible","breakpoints","modal"],[1,"p-fluid","grid"],[1,"field","col-12"],["for","name"],["type","text","pInputText","","id","name","required","","autofocus","",3,"ngModelChange","ngModel","ngClass"],["class","ng-dirty ng-invalid",4,"ngIf"],["for","valor"],["inputId","stacked","mode","currency","currency","BRL","autofocus","",3,"ngModelChange","ngModel","showButtons","ngClass"],[1,"field","col-6"],["pButton","","pRipple","","label","Cancelar","icon","pi pi-times",1,"p-button-danger",3,"click"],["pButton","","pRipple","","label","Salvar","icon","pi pi-check",1,"p-button-success",3,"click"],["header","Confirmar Exclus\xE3o",3,"visibleChange","visible","modal","breakpoints"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"m-0"],[1,"pi","pi-dollar","mr-2"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Procurar...",1,"w-full","sm:w-auto",3,"input"],[2,"width","3rem"],["pSortableColumn","id",4,"ngIf"],["pSortableColumn","nome"],["field","nome"],["pSortableColumn","valor"],["pSortableColumn","nrClientes",2,"width","150px","min-width","150px"],["field","nrClientes"],["pSortableColumn","id"],["field","id"],[3,"value"],[1,"p-column-title"],[2,"width","150px","min-width","150px","text-align","center"],[1,"badge"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-rounded","p-button-success","mr-2",3,"click"],["pButton","","pRipple","","icon","pi pi-trash",1,"p-button-rounded","p-button-warning",3,"click"],[1,"ng-dirty","ng-invalid"],["pButton","","pRipple","","icon","pi pi-times","label","N\xE3o",1,"p-button-text",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Sim",1,"p-button-text",3,"click"]],template:function(l,t){if(l&1){let r=P();o(0,"div",1)(1,"div",2)(2,"div",3),g(3,"p-toast"),o(4,"p-table",4,0),v("selectionChange",function(s){return m(r),x(t.listaPlanosSelecionados,s)||(t.listaPlanosSelecionados=s),c(s)}),b(6,Me,7,0,"ng-template",5)(7,Ie,14,1,"ng-template",6)(8,Ve,21,5,"ng-template",7),n()(),o(9,"button",8),h("click",function(){return m(r),c(t.novo())}),n(),o(10,"p-dialog",9),v("visibleChange",function(s){return m(r),x(t.dialogoPlano,s)||(t.dialogoPlano=s),c(s)}),o(11,"div",10)(12,"div",11)(13,"label",12),a(14,"Nome:"),n(),o(15,"input",13),v("ngModelChange",function(s){return m(r),x(t.planoSelecionado.nome,s)||(t.planoSelecionado.nome=s),c(s)}),n(),b(16,Fe,2,0,"small",14),n(),o(17,"div",11)(18,"label",15),a(19,"Valor:"),n(),o(20,"p-inputNumber",16),v("ngModelChange",function(s){return m(r),x(t.planoSelecionado.valor,s)||(t.planoSelecionado.valor=s),c(s)}),n(),b(21,Be,2,0,"small",14),n(),o(22,"div",17)(23,"button",18),h("click",function(){return m(r),c(t.dialogoPlano=!1)}),n()(),o(24,"div",17)(25,"button",19),h("click",function(){return m(r),c(t.salvarOuAlterar())}),n()()()(),o(26,"p-dialog",20),v("visibleChange",function(s){return m(r),x(t.dialogoExcluirSelecionados,s)||(t.dialogoExcluirSelecionados=s),c(s)}),o(27,"div",21),g(28,"i",22),b(29,Ne,2,0,"span",23)(30,Re,5,1,"span",23),n(),b(31,Oe,2,0,"ng-template",24),n()()()}l&2&&(p(4),d("value",t.listaPlanos)("columns",t.cols)("rows",10)("globalFilterFields",S(29,ye))("rows",10)("paginator",!0)("rowsPerPageOptions",S(30,Ee))("showCurrentPageReport",!0),C("selection",t.listaPlanosSelecionados),d("rowHover",!0),p(6),k(S(31,Se)),C("visible",t.dialogoPlano),d("breakpoints",S(32,Ce))("modal",!0),p(5),C("ngModel",t.planoSelecionado.nome),d("ngClass",F(33,xe,t.submitted&&!t.planoSelecionado.nome)),p(),d("ngIf",t.submitted&&!t.planoSelecionado.nome),p(4),C("ngModel",t.planoSelecionado.valor),d("showButtons",!1)("ngClass",F(35,xe,t.submitted&&!t.planoSelecionado.valor)),p(),d("ngIf",t.submitted&&!t.planoSelecionado.valor),p(5),k(S(37,Se)),C("visible",t.dialogoExcluirSelecionados),d("modal",!0)("breakpoints",S(38,Ce)),p(3),d("ngIf",t.listaPlanosSelecionados.length===1),p(),d("ngIf",t.listaPlanosSelecionados.length>1))},dependencies:[D,A,le,z,ae,re,se,pe,J,G,H,U,Q,L,he,te,ne,ce],styles:[".fab[_ngcontent-%COMP%]{position:fixed!important;z-index:1030!important;right:2rem!important;bottom:2rem!important;width:56px!important;height:56px!important;transition:all .3s cubic-bezier(.4,0,.2,1)!important;animation:_ngcontent-%COMP%_fadeInUp .4s ease-out}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.1) translateY(-2px)!important;box-shadow:0 8px 16px #0000004d!important}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.list-card[_ngcontent-%COMP%]{position:relative;padding-bottom:100px}@media (max-width: 768px){.fab[_ngcontent-%COMP%]{width:48px!important;height:48px!important;right:1rem!important;bottom:1rem!important;bottom:calc(1rem + env(safe-area-inset-bottom,0px))!important}.fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem!important}.list-card[_ngcontent-%COMP%]{padding-bottom:80px}}[_nghost-%COMP%]{position:relative;min-height:100vh}.badge[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border-radius:12px;padding:2px 8px;font-size:.875rem;font-weight:500;display:inline-block;min-width:24px;text-align:center}"]})}}return i})();var we=(()=>{class i{static{this.\u0275fac=function(l){return new(l||i)}}static{this.\u0275mod=E({type:i})}static{this.\u0275inj=w({imports:[B.forChild([{path:"",component:Pe}]),B]})}}return i})();var St=(()=>{class i{static{this.\u0275fac=function(l){return new(l||i)}}static{this.\u0275mod=E({type:i})}static{this.\u0275inj=w({imports:[j,we,me,ue,Y,X,q,_e,be,fe,ie,ge,ee,K,oe,de]})}}return i})();export{St as PlanoModule};
