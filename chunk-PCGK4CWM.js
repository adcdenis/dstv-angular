import{a as $}from"./chunk-AW5DFX2W.js";import{b as ve}from"./chunk-ERPGQRCJ.js";import{a as pe,b as me}from"./chunk-YOAYV4RA.js";import"./chunk-2JY635KS.js";import{b as _e}from"./chunk-6BD7PSS4.js";import{b as ue}from"./chunk-5WWM3MYI.js";import"./chunk-WSDER2HD.js";import"./chunk-T6OX34SV.js";import{b as K}from"./chunk-UDPXU5AZ.js";import{a as Z}from"./chunk-77VZTUG6.js";import{a as ge,b as Se}from"./chunk-DTX2IFH6.js";import{b as fe}from"./chunk-MRQLE57Y.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import{a as ne,d as le,e as ae,h as se,i as de,k as ce}from"./chunk-C3W5HSCK.js";import"./chunk-5CO6IPWY.js";import"./chunk-UNGKZQU4.js";import"./chunk-4RURM2DY.js";import{b as oe,c as re}from"./chunk-UHPR5IVD.js";import"./chunk-T2PIK6R3.js";import"./chunk-7SPUUUGD.js";import"./chunk-SFTIWTHH.js";import{i as ee}from"./chunk-VPFJ3TVV.js";import"./chunk-NJPLBFLS.js";import"./chunk-MDZH7E7N.js";import"./chunk-V6X5IB37.js";import"./chunk-V5XYQFDX.js";import"./chunk-3GJN2BSD.js";import"./chunk-UW4E5NSV.js";import"./chunk-6LXUGSQP.js";import{a as te,b as ie}from"./chunk-RD2ZW53S.js";import"./chunk-UAXJ67OE.js";import{b as G,e as H,g as Q,k as U,m as Y}from"./chunk-ENZ5W56S.js";import"./chunk-S35HUXPS.js";import{b as J,d as X}from"./chunk-4B2QLF32.js";import{k as P,p as z,s as L,t as q}from"./chunk-BFP4OEA6.js";import{Aa as f,Bb as j,F as y,Ja as N,Ka as a,L as c,La as I,M as p,Ma as V,Oa as b,Pa as C,Qa as x,Ra as B,Sa as h,Ta as D,Tb as O,Y as d,Z as M,da as R,ea as E,ja as _,ma as m,pa as k,rb as W,sa as o,ta as r,tb as A,ua as u,ya as w,za as g}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{a as F,h as T}from"./chunk-MG3ERZGY.js";var ye=()=>["nome","id"],Me=()=>[10,20,30],he=()=>({width:"450px"}),Ee=()=>({"960px":"75vw","640px":"100vw"}),Pe=i=>({"ng-invalid ng-dirty":i}),Te=()=>({"960px":"50vw","640px":"90vw"});function ke(i,S){i&1&&(o(0,"th",38),a(1,"Id "),u(2,"p-sortIcon",39),r())}function Ie(i,S){i&1&&(o(0,"tr")(1,"th",32),u(2,"p-tableHeaderCheckbox"),r(),_(3,ke,3,0,"th",33),o(4,"th",34),a(5,"Nome "),u(6,"p-sortIcon",35),r(),o(7,"th",36),a(8,"Clientes "),u(9,"p-sortIcon",37),r(),u(10,"th"),r()),i&2&&(d(3),m("ngIf",!1))}function Ve(i,S){if(i&1&&(o(0,"td")(1,"span",43),a(2,"Id"),r(),a(3),r()),i&2){let e=f().$implicit;d(3),V(" ",e.id," ")}}function Oe(i,S){if(i&1){let e=w();o(0,"tr",40)(1,"td"),u(2,"p-tableCheckbox",41),r(),_(3,Ve,4,1,"td",31),o(4,"td",42),g("click",function(){let t=c(e).$implicit,s=f();return p(s.abrirDialogAlterar(t))}),o(5,"span",43),a(6,"Nome"),r(),a(7),r(),o(8,"td",44),g("click",function(){let t=c(e).$implicit,s=f();return p(s.abrirDialogAlterar(t))}),o(9,"span",43),a(10,"Clientes"),r(),o(11,"span",45),a(12),r()(),o(13,"td")(14,"div",46)(15,"button",47),g("click",function(){c(e);let t=f();return p(t.abrirDialogExcluirSelecionados())}),r()()()()}if(i&2){let e=S.$implicit,n=f();d(2),m("value",e),d(),m("ngIf",!1),d(4),V(" ",e.nome," "),d(5),I(n.getNumeroClientes(e.id))}}function Fe(i,S){i&1&&(o(0,"small",48),a(1,"O nome \xE9 obrigat\xF3rio."),r())}function Re(i,S){if(i&1){let e=w();o(0,"button",49),g("click",function(){c(e);let t=f();return p(t.dialogoServidor=!1)}),r(),o(1,"button",50),g("click",function(){c(e);let t=f();return p(t.salvarOuAlterar())}),r()}}function Ne(i,S){i&1&&(o(0,"span"),a(1,"Tem certeza que voc\xEA deseja excluir o servidor selecionado?"),r())}function Be(i,S){if(i&1&&(o(0,"span"),a(1,"Tem certeza que voc\xEA deseja excluir os "),o(2,"b"),a(3),r(),a(4," servidores selecionados? Todos ser\xE3o exclu\xEDdos."),r()),i&2){let e=f();d(3),I(e.listaServidoresSelecionados.length)}}function De(i,S){if(i&1){let e=w();o(0,"button",51),g("click",function(){c(e);let t=f();return p(t.dialogoExcluirSelecionados=!1)}),r(),o(1,"button",52),g("click",function(){c(e);let t=f();return p(t.excluirSelecionados())}),r()}}var Ce=(()=>{class i{constructor(e,n,t){this.servidorService=e,this.messageService=n,this.clienteService=t,this.listaServidores=[],this.listaServidoresSelecionados=[],this.dialogoServidor=!1,this.dialogoExcluirSelecionados=!1,this.servidorSelecionado={},this.cols=[],this.submitted=!1,this.clientesPorServidor={}}ngOnInit(){console.log("aqui"),this.cols=[{field:"id",header:"Id"},{field:"nome",header:"Nome"},{field:"nrClientes",header:"Clientes"}],this.servidorService.getAll().subscribe({next:e=>{this.listaServidores=e,this.carregarContagemClientes()},error:e=>console.error(e),complete:()=>console.info("complete")})}salvarOuAlterar(){if(this.submitted=!0,!this.servidorSelecionado.nome||this.servidorSelecionado.nome.trim().length==0){this.messageService.add({severity:"error",summary:"Erro!",detail:"Insira um nome!",life:3e3});return}this.servidorSelecionado.id?this.alterar():this.salvar()}salvar(){this.servidorService.create(this.servidorSelecionado).then(()=>{this.dialogoServidor=!1,this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Servidor Criado!",life:3e3}),this.servidorService.getAll().subscribe({next:e=>{this.listaServidores=e,this.carregarContagemClientes()},error:e=>console.error(e),complete:()=>console.info("complete")})})}abrirDialogAlterar(e){this.servidorSelecionado=F({},e),this.submitted=!1,this.dialogoServidor=!0}alterar(){this.servidorService.update(this.servidorSelecionado).then(()=>{this.dialogoServidor=!1,this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Servidor Alterado!",life:3e3}),this.servidorService.getAll().subscribe({next:e=>{this.listaServidores=e,this.carregarContagemClientes()},error:e=>console.error(e),complete:()=>console.info("complete")})})}onGlobalFilter(e,n){e.filterGlobal(n.target.value,"contains")}novo(){this.dialogoServidor=!0,this.servidorSelecionado={}}abrirDialogExcluirSelecionados(){if(!this.listaServidoresSelecionados||this.listaServidoresSelecionados.length===0){this.messageService.add({severity:"warn",summary:"Aten\xE7\xE3o!",detail:"Por favor, selecione pelo menos um servidor para excluir.",life:3e3});return}this.dialogoExcluirSelecionados=!0}carregarContagemClientes(){return T(this,null,function*(){this.clientesPorServidor={};for(let e of this.listaServidores)if(e.id){let t=(yield this.clienteService.getByServidor(e.id)).docs.map(s=>s.data());this.clientesPorServidor[e.id]=t.length,e.nrClientes=t.length}this.listaServidores=[...this.listaServidores]})}getNumeroClientes(e){return e&&this.clientesPorServidor[e]||0}excluirSelecionados(){return T(this,null,function*(){if(this.listaServidoresSelecionados){let e=[];for(let n of this.listaServidoresSelecionados){let s=(yield this.clienteService.getByServidor(n.id||"")).docs.map(v=>v.data());s.length>0&&e.push({servidor:n,clientes:s})}if(e.length>0){let n=`Os seguintes servidores n\xE3o podem ser exclu\xEDdos pois est\xE3o sendo utilizados por clientes:
`;e.forEach(t=>{let s=t.clientes.map(v=>v.nome).join(", ");n+=`
\u2022 ${t.servidor.nome}: ${s}`}),this.messageService.add({severity:"error",summary:"Erro ao excluir!",detail:n,life:8e3}),this.dialogoExcluirSelecionados=!1;return}this.listaServidoresSelecionados.forEach(n=>{this.servidorService.delete(n.id||"")}),this.dialogoExcluirSelecionados=!1,this.listaServidoresSelecionados=[],this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Servidores Exclu\xEDdos",life:3e3}),this.servidorService.getAll().subscribe({next:n=>{this.listaServidores=n,this.carregarContagemClientes()},error:n=>console.error(n),complete:()=>console.info("complete")})}})}static{this.\u0275fac=function(n){return new(n||i)(M($),M(P),M(Z))}}static{this.\u0275cmp=R({type:i,selectors:[["app-servidor"]],standalone:!1,features:[B([P])],decls:41,vars:36,consts:[["dt",""],[1,"grid"],[1,"col-12"],[1,"card","p-0","overflow-hidden","border-none","shadow-2"],[1,"p-4","bg-primary","text-white","flex","align-items-center","justify-content-between"],[1,"flex","align-items-center","gap-3"],[1,"pi","pi-server","text-3xl"],[1,"text-2xl","font-bold","m-0","text-white"],[1,"m-0","text-primary-100","opacity-80"],[1,"p-input-icon-right","w-full","md:w-20rem"],[1,"pi","pi-search","text-500"],["pInputText","","type","text","placeholder","Pesquisar servidores...",1,"w-full","p-3","border-round-xl",3,"input"],[1,"p-4"],["styleClass","p-datatable-striped list-table servidores-table","responsiveLayout","stack","currentPageReportTemplate","Mostrando {first} at\xE9 {last} de {totalRecords} registros","selectionMode","multiple","dataKey","id",3,"selectionChange","value","columns","rows","globalFilterFields","paginator","rowsPerPageOptions","showCurrentPageReport","selection","rowHover"],["pTemplate","header"],["pTemplate","body"],["pButton","","pRipple","","icon","pi pi-plus",1,"p-button-rounded","p-button-success","fab",3,"click"],[1,"p-fluid",3,"visibleChange","visible","breakpoints","header","modal"],[1,"grid","mt-2"],[1,"field","col-12"],["for","name",1,"font-bold","text-900"],[1,"p-input-icon-left"],[1,"pi","pi-server"],["type","text","pInputText","","id","name","required","","autofocus","","placeholder","Ex: Servidor Principal",3,"ngModelChange","ngModel","ngClass"],["class","p-error block",4,"ngIf"],["for","valorCredito",1,"font-bold","text-900"],["id","valorCredito","mode","currency","currency","BRL","locale","pt-BR","placeholder","R$ 0,00",3,"ngModelChange","ngModel","minFractionDigits"],["pTemplate","footer"],["header","Confirmar Exclus\xE3o",3,"visibleChange","visible","modal","breakpoints"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],[2,"width","3rem"],["pSortableColumn","id",4,"ngIf"],["pSortableColumn","nome"],["field","nome"],["pSortableColumn","nrClientes",2,"width","150px","min-width","150px"],["field","nrClientes"],["pSortableColumn","id"],["field","id"],[1,"cursor-pointer"],[3,"value"],[3,"click"],[1,"p-column-title"],[2,"width","150px","min-width","150px","text-align","center",3,"click"],[1,"badge"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-trash",1,"p-button-rounded","p-button-warning",3,"click"],[1,"p-error","block"],["pButton","","pRipple","","label","Cancelar","icon","pi pi-times",1,"p-button-text","p-button-secondary",3,"click"],["pButton","","pRipple","","label","Salvar Servidor","icon","pi pi-check",1,"p-button-primary","border-round-lg",3,"click"],["pButton","","pRipple","","icon","pi pi-times","label","N\xE3o",1,"p-button-text",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Sim",1,"p-button-text",3,"click"]],template:function(n,t){if(n&1){let s=w();o(0,"div",1),u(1,"p-toast"),o(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),u(6,"i",6),o(7,"div")(8,"h1",7),a(9,"Gerenciar Servidores"),r(),o(10,"p",8),a(11,"Cadastro e gest\xE3o de servidores do sistema"),r()()(),o(12,"span",9),u(13,"i",10),o(14,"input",11),g("input",function(l){c(s);let we=N(17);return p(t.onGlobalFilter(we,l))}),r()()(),o(15,"div",12)(16,"p-table",13,0),x("selectionChange",function(l){return c(s),C(t.listaServidoresSelecionados,l)||(t.listaServidoresSelecionados=l),p(l)}),_(18,Ie,11,1,"ng-template",14)(19,Oe,16,4,"ng-template",15),r()()(),o(20,"button",16),g("click",function(){return c(s),p(t.novo())}),r(),o(21,"p-dialog",17),x("visibleChange",function(l){return c(s),C(t.dialogoServidor,l)||(t.dialogoServidor=l),p(l)}),o(22,"div",18)(23,"div",19)(24,"label",20),a(25,"Nome do Servidor"),r(),o(26,"span",21),u(27,"i",22),o(28,"input",23),x("ngModelChange",function(l){return c(s),C(t.servidorSelecionado.nome,l)||(t.servidorSelecionado.nome=l),p(l)}),r()(),_(29,Fe,2,0,"small",24),r(),o(30,"div",19)(31,"label",25),a(32,"Custo por Cr\xE9dito"),r(),o(33,"p-inputNumber",26),x("ngModelChange",function(l){return c(s),C(t.servidorSelecionado.valorCredito,l)||(t.servidorSelecionado.valorCredito=l),p(l)}),r()()(),_(34,Re,2,0,"ng-template",27),r(),o(35,"p-dialog",28),x("visibleChange",function(l){return c(s),C(t.dialogoExcluirSelecionados,l)||(t.dialogoExcluirSelecionados=l),p(l)}),o(36,"div",29),u(37,"i",30),_(38,Ne,2,0,"span",31)(39,Be,5,1,"span",31),r(),_(40,De,2,0,"ng-template",27),r()()()}n&2&&(d(16),m("value",t.listaServidores)("columns",t.cols)("rows",10)("globalFilterFields",h(28,ye))("rows",10)("paginator",!0)("rowsPerPageOptions",h(29,Me))("showCurrentPageReport",!0),b("selection",t.listaServidoresSelecionados),m("rowHover",!0),d(5),k(h(30,he)),b("visible",t.dialogoServidor),m("breakpoints",h(31,Ee))("header",t.servidorSelecionado.id?"Editar Servidor":"Novo Servidor")("modal",!0),d(7),b("ngModel",t.servidorSelecionado.nome),m("ngClass",D(32,Pe,t.submitted&&!t.servidorSelecionado.nome)),d(),m("ngIf",t.submitted&&!t.servidorSelecionado.nome),d(4),b("ngModel",t.servidorSelecionado.valorCredito),m("minFractionDigits",2),d(2),k(h(34,he)),b("visible",t.dialogoExcluirSelecionados),m("modal",!0)("breakpoints",h(35,Te)),d(3),m("ngIf",t.listaServidoresSelecionados.length===1),d(),m("ngIf",t.listaServidoresSelecionados.length>1))},dependencies:[W,A,ne,z,le,ae,se,de,J,G,H,U,Q,L,ge,te,oe,pe],styles:[".fab[_ngcontent-%COMP%]{position:fixed!important;z-index:1030!important;right:2rem!important;bottom:2rem!important;width:56px!important;height:56px!important;transition:all .3s cubic-bezier(.4,0,.2,1)!important;animation:_ngcontent-%COMP%_fadeInUp .4s ease-out}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.1) translateY(-2px)!important;box-shadow:0 8px 16px #0000004d!important}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.list-card[_ngcontent-%COMP%]{position:relative;padding-bottom:100px}@media (max-width: 768px){.fab[_ngcontent-%COMP%]{width:48px!important;height:48px!important;right:1rem!important;bottom:1rem!important;bottom:calc(1rem + env(safe-area-inset-bottom,0px))!important}.fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem!important}.list-card[_ngcontent-%COMP%]{padding-bottom:80px}}[_nghost-%COMP%]{position:relative;min-height:100vh}.badge[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border-radius:12px;padding:2px 8px;font-size:.875rem;font-weight:500;display:inline-block;min-width:24px;text-align:center}[_nghost-%COMP%]     .servidores-table th:nth-child(4), [_nghost-%COMP%]     .servidores-table td:nth-child(4){width:150px;min-width:150px;text-align:center}.bg-primary[_ngcontent-%COMP%]   .p-input-icon-right[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:#ffffff1a!important;border-color:#ffffff4d!important;color:#fff!important}.bg-primary[_ngcontent-%COMP%]   .p-input-icon-right[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#ffffffb3!important}.bg-primary[_ngcontent-%COMP%]   .p-input-icon-right[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{background-color:#ffffff26!important;border-color:#ffffff80!important;box-shadow:0 0 0 2px #ffffff4d!important}.bg-primary[_ngcontent-%COMP%]   .p-input-icon-right[_ngcontent-%COMP%]   .pi-search[_ngcontent-%COMP%]{color:#ffffffb3!important}"]})}}return i})();var xe=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=E({type:i})}static{this.\u0275inj=y({imports:[O.forChild([{path:"",component:Ce}]),O]})}}return i})();var bt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=E({type:i})}static{this.\u0275inj=y({imports:[j,xe,ce,ue,Y,X,q,Se,_e,ve,ie,fe,ee,K,re,me]})}}return i})();export{bt as ServidorModule};
