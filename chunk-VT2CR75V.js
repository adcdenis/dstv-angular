import{a as ge,b as he}from"./chunk-2F7RCEGF.js";import{a as Ce,b as _e}from"./chunk-YL7DZIPE.js";import{a as ve}from"./chunk-TYJRV2V5.js";import{a as ee}from"./chunk-AW5DFX2W.js";import{a as te}from"./chunk-ULMLR6ZN.js";import{b as fe}from"./chunk-6BD7PSS4.js";import{a as Z}from"./chunk-77VZTUG6.js";import{a as pe,b as ue}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import{a as se,d as ce,e as de,k as me}from"./chunk-QXXVWUSP.js";import"./chunk-MZURXKLX.js";import{a as oe,b as ie}from"./chunk-4Q7UP2TF.js";import"./chunk-XCSSQDET.js";import"./chunk-LJGI4ZRP.js";import"./chunk-T2PIK6R3.js";import"./chunk-7SPUUUGD.js";import"./chunk-SFTIWTHH.js";import{h as ne,i as re}from"./chunk-WSIWJYJX.js";import"./chunk-NJPLBFLS.js";import"./chunk-MDZH7E7N.js";import"./chunk-V6X5IB37.js";import"./chunk-V5XYQFDX.js";import"./chunk-3GJN2BSD.js";import"./chunk-UW4E5NSV.js";import"./chunk-6LXUGSQP.js";import{a as ae,b as le}from"./chunk-UGHG6TU3.js";import"./chunk-UAXJ67OE.js";import{e as G,f as $,h as q,i as z,j as J,m as K,n as Q,o as U}from"./chunk-KLIUDW4T.js";import"./chunk-S35HUXPS.js";import{b as W,d as X}from"./chunk-4B2QLF32.js";import{g as D,k as H,p as A}from"./chunk-BFP4OEA6.js";import{Aa as I,Bb as Y,F as P,Ka as a,L as b,La as _,M as w,Ra as B,Sa as N,Tb as V,Y as d,Z as C,da as j,ea as R,ja as T,ma as u,sa as n,ta as o,tb as L,u as E,ua as m,ya as O,za as x}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{h as M}from"./chunk-MG3ERZGY.js";var xe=()=>[10,20,30],ye=()=>["cliente.nome","plano.nome","servidor.nome"];function Fe(r,S){r&1&&(n(0,"div",33),m(1,"i",34),o())}function Me(r,S){r&1&&(n(0,"tr")(1,"th",39),a(2,"Data/Hora Renova\xE7\xE3o "),m(3,"p-sortIcon",40),o(),n(4,"th",41),a(5,"Cliente "),m(6,"p-sortIcon",42),o(),n(7,"th",43),a(8,"Plano "),m(9,"p-sortIcon",44),o(),n(10,"th",45),a(11,"Servidor "),m(12,"p-sortIcon",46),o(),n(13,"th",47),a(14,"Novo Vencimento "),m(15,"p-sortIcon",48),o(),n(16,"th",49),a(17,"A\xE7\xF5es"),o()())}function Ee(r,S){if(r&1){let e=O();n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o(),n(5,"td"),a(6),o(),n(7,"td"),a(8),o(),n(9,"td"),a(10),o(),n(11,"td")(12,"button",50),x("click",function(){let i=b(e).$implicit,c=I(2);return w(c.confirmarExclusao(i))}),o()()()}if(r&2){let e=S.$implicit,t=I(2);d(2),_(t.formatarData(e.dataHoraRenovacao)),d(2),_((e.cliente==null?null:e.cliente.nome)||"-"),d(2),_((e.plano==null?null:e.plano.nome)||"-"),d(2),_((e.servidor==null?null:e.servidor.nome)||"-"),d(2),_(t.formatarDataSemHora(e.dataNovoVencimento))}}function Pe(r,S){r&1&&(n(0,"tr")(1,"td",51),a(2," Nenhum registro de renova\xE7\xE3o encontrado com os filtros selecionados. "),o()())}function Re(r,S){if(r&1&&(n(0,"p-table",35,1),T(2,Me,18,0,"ng-template",36)(3,Ee,13,5,"ng-template",37)(4,Pe,3,0,"ng-template",38),o()),r&2){let e=I();u("value",e.listaHistorico)("columns",e.cols)("rows",10)("paginator",!0)("rowsPerPageOptions",N(9,xe))("showCurrentPageReport",!0)("globalFilterFields",N(10,ye))("rowHover",!0)("sortOrder",-1)}}var be=(()=>{class r{constructor(e,t,i,c,f,v,g){this.historicoService=e,this.clienteService=t,this.planoService=i,this.servidorService=c,this.messageService=f,this.confirmationService=v,this.formBuilder=g,this.listaHistorico=[],this.listaClientes=[],this.clientesFiltrados=[],this.listaPlanos=[],this.listaServidores=[],this.isLoading=!0,this.filtroForm=this.formBuilder.group({cliente:[""],plano:[""],servidor:[""],dataInicio:[""],dataFim:[""]}),this.cols=[],this.converterDateToTimeStamp=h=>{let y=h.dataHoraRenovacao;if(y&&y.seconds){let l=new Date(y.seconds*1e3);h.dataHoraRenovacao=l}let s=h.dataNovoVencimento;if(s&&s.seconds){let l=new Date(s.seconds*1e3);h.dataNovoVencimento=l}return h}}ngOnInit(){this.cols=[{field:"dataHoraRenovacao",header:"Data/Hora Renova\xE7\xE3o"},{field:"cliente.nome",header:"Cliente"},{field:"plano.nome",header:"Plano"},{field:"servidor.nome",header:"Servidor"},{field:"dataNovoVencimento",header:"Novo Vencimento"}];let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0);this.filtroForm.patchValue({dataInicio:t,dataFim:i}),this.carregarDados()}formatDateForInput(e){let t=e.getFullYear(),i=(e.getMonth()+1).toString().padStart(2,"0"),c=e.getDate().toString().padStart(2,"0");return`${t}-${i}-${c}`}carregarDados(){return M(this,null,function*(){this.isLoading=!0;try{let[e,t,i]=yield Promise.all([this.clienteService.getAll().pipe(E(1)).toPromise(),this.planoService.getAll().pipe(E(1)).toPromise(),this.servidorService.getAll().pipe(E(1)).toPromise()]);this.listaClientes=e||[],this.listaPlanos=t||[],this.listaServidores=i||[],yield this.aplicarFiltros()}catch(e){console.error("Erro ao carregar dados:",e),this.messageService.add({severity:"error",summary:"Erro!",detail:"N\xE3o foi poss\xEDvel carregar os dados.",life:3e3})}finally{this.isLoading=!1}})}aplicarFiltros(){return M(this,null,function*(){this.isLoading=!0;try{let e=this.filtroForm.value,t=e.cliente,i=t&&typeof t=="object"?t.id:t,c=e.plano,f=e.servidor,v=e.dataInicio?e.dataInicio:void 0,g=e.dataFim?e.dataFim:void 0;g&&g.setHours(23,59,59,999);let h=yield this.historicoService.getByFiltros(i,c,f,v,g);if((i?1:0)+(c?1:0)+(f?1:0)+(v&&g?1:0)>1){let s=h.docs;i&&(s=s.filter(l=>{let p=l.data();return p.cliente&&p.cliente.id===i})),c&&(s=s.filter(l=>{let p=l.data();return p.plano&&p.plano.id===c})),f&&(s=s.filter(l=>{let p=l.data();return p.servidor&&p.servidor.id===f})),v&&g&&(s=s.filter(l=>{let F=l.data().dataHoraRenovacao;if(!F)return!1;let k=F.seconds?new Date(F.seconds*1e3):F;return k>=v&&k<=g})),this.listaHistorico=s.map(l=>{let p=l.data();return p.id=l.id,this.converterDateToTimeStamp(p)})}else this.listaHistorico=h.docs.map(s=>{let l=s.data();return l.id=s.id,this.converterDateToTimeStamp(l)})}catch(e){console.error("Erro ao aplicar filtros:",e),this.messageService.add({severity:"error",summary:"Erro!",detail:"N\xE3o foi poss\xEDvel aplicar os filtros.",life:3e3})}finally{this.isLoading=!1}})}limparFiltros(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0);this.filtroForm.patchValue({cliente:null,plano:"",servidor:"",dataInicio:t,dataFim:i}),this.clientesFiltrados=[],this.aplicarFiltros()}formatarData(e){if(!e)return"";let t=e;return t&&t.seconds&&(e=new Date(t.seconds*1e3)),e.toLocaleString("pt-BR")}formatarDataSemHora(e){if(!e)return"";let t=e;return t&&t.seconds&&(e=new Date(t.seconds*1e3)),e.toLocaleDateString("pt-BR")}onGlobalFilter(e,t){e.filterGlobal(t.target.value,"contains")}filtrarClientes(e){let t=e.query.toLowerCase();if(!t||t.length<3){this.clientesFiltrados=[];return}this.clientesFiltrados=this.listaClientes.filter(i=>i.nome&&i.nome.toLowerCase().includes(t))}confirmarExclusao(e){this.confirmationService.confirm({message:`Tem certeza que deseja excluir o registro de renova\xE7\xE3o do cliente "${e.cliente?.nome}"?`,header:"Confirma\xE7\xE3o de Exclus\xE3o",icon:"pi pi-exclamation-triangle",accept:()=>{this.excluirHistorico(e)}})}excluirHistorico(e){return M(this,null,function*(){try{if(!e.id){this.messageService.add({severity:"error",summary:"Erro!",detail:"ID do registro n\xE3o encontrado.",life:3e3});return}yield this.historicoService.delete(e.id),this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Registro exclu\xEDdo com sucesso.",life:3e3}),yield this.aplicarFiltros()}catch(t){console.error("Erro ao excluir hist\xF3rico:",t),this.messageService.add({severity:"error",summary:"Erro!",detail:"N\xE3o foi poss\xEDvel excluir o registro.",life:3e3})}})}static{this.\u0275fac=function(t){return new(t||r)(C(ve),C(Z),C(te),C(ee),C(H),C(D),C(K))}}static{this.\u0275cmp=j({type:r,selectors:[["app-historico-renovacoes"]],standalone:!1,features:[B([H,D])],decls:46,vars:14,consts:[["globalFilter",""],["dt",""],[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6","fade-in","list-card"],[1,"mb-4"],[1,"pi","pi-history","mr-2"],[1,"card","mb-4",2,"position","relative","z-index","1"],[1,"mb-3"],[1,"grid",3,"formGroup"],[1,"col-12","md:col-6","lg:col-4"],["for","dataInicio",1,"block","text-900","font-medium","mb-2"],["id","dataInicio","formControlName","dataInicio","dateFormat","dd/mm/yy","placeholder","Data in\xEDcio","appendTo","body",1,"w-full",3,"showIcon","showButtonBar"],["for","dataFim",1,"block","text-900","font-medium","mb-2"],["id","dataFim","formControlName","dataFim","dateFormat","dd/mm/yy","placeholder","Data fim","appendTo","body",1,"w-full",3,"showIcon","showButtonBar"],[1,"col-12","md:col-12","lg:col-4","flex","align-items-end"],[1,"flex","gap-2"],["pButton","","pRipple","","label","Filtrar","icon","pi pi-filter",1,"p-button-primary",3,"click"],["pButton","","pRipple","","label","Limpar","icon","pi pi-times",1,"p-button-secondary",3,"click"],["for","cliente",1,"block","text-900","font-medium","mb-2"],["id","cliente","formControlName","cliente","field","nome","placeholder","Digite pelo menos 3 caracteres","appendTo","body",1,"w-full",3,"completeMethod","suggestions","minLength","showClear"],["for","plano",1,"block","text-900","font-medium","mb-2"],["id","plano","formControlName","plano","optionLabel","nome","optionValue","id","placeholder","Todos os planos","appendTo","body",1,"w-full",3,"options","showClear"],["for","servidor",1,"block","text-900","font-medium","mb-2"],["id","servidor","formControlName","servidor","optionLabel","nome","optionValue","id","placeholder","Todos os servidores","appendTo","body",1,"w-full",3,"options","showClear"],[1,"card"],[1,"flex","justify-content-between","align-items-center","mb-4"],[1,"m-0"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Pesquisar...",1,"w-full"],["class","flex justify-content-center p-5",4,"ngIf"],["responsiveLayout","stack","currentPageReportTemplate","Mostrando {first} at\xE9 {last} de {totalRecords} registros","sortField","dataHoraRenovacao",3,"value","columns","rows","paginator","rowsPerPageOptions","showCurrentPageReport","globalFilterFields","rowHover","sortOrder",4,"ngIf"],[1,"flex","justify-content-center","p-5"],[1,"pi","pi-spin","pi-spinner","text-4xl"],["responsiveLayout","stack","currentPageReportTemplate","Mostrando {first} at\xE9 {last} de {totalRecords} registros","sortField","dataHoraRenovacao",3,"value","columns","rows","paginator","rowsPerPageOptions","showCurrentPageReport","globalFilterFields","rowHover","sortOrder"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pSortableColumn","dataHoraRenovacao"],["field","dataHoraRenovacao"],["pSortableColumn","cliente.nome"],["field","cliente.nome"],["pSortableColumn","plano.nome"],["field","plano.nome"],["pSortableColumn","servidor.nome"],["field","servidor.nome"],["pSortableColumn","dataNovoVencimento"],["field","dataNovoVencimento"],[2,"width","8rem"],["pButton","","pRipple","","icon","pi pi-trash","title","Excluir",1,"p-button-rounded","p-button-danger","p-button-outlined","mr-2","mb-2",3,"click"],["colspan","6",1,"text-center"]],template:function(t,i){if(t&1){let c=O();n(0,"div",2),m(1,"p-toast")(2,"p-confirmDialog"),n(3,"div",3)(4,"div",4)(5,"h5",5),m(6,"i",6),a(7,"Hist\xF3rico de Renova\xE7\xF5es"),o(),n(8,"div",7)(9,"h6",8),a(10,"Filtros"),o(),n(11,"form",9)(12,"div",10)(13,"label",11),a(14,"Data In\xEDcio"),o(),m(15,"p-calendar",12),o(),n(16,"div",10)(17,"label",13),a(18,"Data Fim"),o(),m(19,"p-calendar",14),o(),n(20,"div",15)(21,"div",16)(22,"button",17),x("click",function(){return b(c),w(i.aplicarFiltros())}),o(),n(23,"button",18),x("click",function(){return b(c),w(i.limparFiltros())}),o()()(),n(24,"div",10)(25,"label",19),a(26,"Cliente"),o(),n(27,"p-autoComplete",20),x("completeMethod",function(v){return b(c),w(i.filtrarClientes(v))}),o()(),n(28,"div",10)(29,"label",21),a(30,"Plano"),o(),m(31,"p-dropdown",22),o(),n(32,"div",10)(33,"label",23),a(34,"Servidor"),o(),m(35,"p-dropdown",24),o()()(),n(36,"div",25)(37,"div",26)(38,"h6",27),a(39,"Registros de Renova\xE7\xE3o"),o(),n(40,"span",28),m(41,"i",29)(42,"input",30,0),o()(),T(44,Fe,2,0,"div",31)(45,Re,5,11,"p-table",32),o()()()()}t&2&&(d(11),u("formGroup",i.filtroForm),d(4),u("showIcon",!0)("showButtonBar",!0),d(4),u("showIcon",!0)("showButtonBar",!0),d(8),u("suggestions",i.clientesFiltrados)("minLength",3)("showClear",!0),d(4),u("options",i.listaPlanos)("showClear",!0),d(4),u("options",i.listaServidores)("showClear",!0),d(9),u("ngIf",i.isLoading),d(),u("ngIf",!i.isLoading))},dependencies:[L,q,G,$,z,J,se,A,ce,de,W,ae,pe,ne,oe,ge,Ce],styles:[".list-card[_ngcontent-%COMP%]   .p-toolbar[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:6px}@media screen and (max-width: 768px){.list-card[_ngcontent-%COMP%]   .clientes-toolbar[_ngcontent-%COMP%]   .p-toolbar-group-left[_ngcontent-%COMP%], .list-card[_ngcontent-%COMP%]   .clientes-toolbar[_ngcontent-%COMP%]   .p-toolbar-group-right[_ngcontent-%COMP%]{width:100%;justify-content:center}}.list-card[_ngcontent-%COMP%]   .clientes-table[_ngcontent-%COMP%]   .p-datatable-tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{padding:.5rem .75rem}.list-card[_ngcontent-%COMP%]   .clientes-table[_ngcontent-%COMP%]   .p-datatable-thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]{background-color:#f8f9fa;font-weight:600}.list-card[_ngcontent-%COMP%]   .p-dropdown-panel[_ngcontent-%COMP%], .list-card[_ngcontent-%COMP%]   .p-datepicker[_ngcontent-%COMP%], .list-card[_ngcontent-%COMP%]   .p-autocomplete-panel[_ngcontent-%COMP%]{z-index:1000!important}.fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}"]})}}return r})();var Ie=[{path:"",component:be}],we=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=R({type:r})}static{this.\u0275inj=P({imports:[V.forChild(Ie),V]})}}return r})();var ut=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=R({type:r})}static{this.\u0275inj=P({imports:[Y,Q,U,we,me,fe,X,le,ue,re,ie,he,_e]})}}return r})();export{ut as HistoricoRenovacoesModule};
