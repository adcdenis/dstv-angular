import{a as $}from"./chunk-ULMLR6ZN.js";import{b as ge}from"./chunk-ERPGQRCJ.js";import{a as me,b as de}from"./chunk-YOAYV4RA.js";import"./chunk-2JY635KS.js";import{b as be}from"./chunk-6BD7PSS4.js";import{b as ue}from"./chunk-5WWM3MYI.js";import"./chunk-WSDER2HD.js";import"./chunk-T6OX34SV.js";import{b as K}from"./chunk-UDPXU5AZ.js";import{a as Z}from"./chunk-77VZTUG6.js";import{a as _e,b as he}from"./chunk-DTX2IFH6.js";import{b as fe}from"./chunk-MRQLE57Y.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import{a as le,d as ae,e as re,h as se,i as pe,k as ce}from"./chunk-C3W5HSCK.js";import"./chunk-5CO6IPWY.js";import"./chunk-UNGKZQU4.js";import"./chunk-4RURM2DY.js";import{b as ne,c as oe}from"./chunk-UHPR5IVD.js";import"./chunk-T2PIK6R3.js";import"./chunk-7SPUUUGD.js";import"./chunk-SFTIWTHH.js";import{i as ee}from"./chunk-VPFJ3TVV.js";import"./chunk-NJPLBFLS.js";import"./chunk-MDZH7E7N.js";import"./chunk-V6X5IB37.js";import"./chunk-V5XYQFDX.js";import"./chunk-3GJN2BSD.js";import"./chunk-UW4E5NSV.js";import"./chunk-6LXUGSQP.js";import{a as te,b as ie}from"./chunk-RD2ZW53S.js";import"./chunk-UAXJ67OE.js";import{b as G,e as H,g as Q,k as U,m as Y}from"./chunk-ENZ5W56S.js";import"./chunk-S35HUXPS.js";import{b as J,d as X}from"./chunk-4B2QLF32.js";import{k as T,p as z,s as L,t as q}from"./chunk-BFP4OEA6.js";import{Aa as f,Bb as j,F as w,Ja as B,Ka as a,L as c,La as I,M as m,Ma as M,Oa as x,Pa as S,Qa as P,Ra as A,Sa as C,Ta as O,Tb as F,Y as p,Z as y,da as N,ea as E,ja as b,ma as d,pa as V,rb as D,sa as n,ta as o,tb as W,ua as u,ya as v,za as g}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{a as R,h as k}from"./chunk-MG3ERZGY.js";var ye=()=>["valor","nome","id"],Ee=()=>[10,20,30],Ce=()=>({width:"450px"}),Me=()=>({"960px":"75vw","640px":"100vw"}),xe=i=>({"ng-invalid ng-dirty":i}),Te=()=>({"960px":"50vw","640px":"90vw"});function ke(i,_){i&1&&(n(0,"th",37),a(1,"Id "),u(2,"p-sortIcon",38),o())}function Ve(i,_){i&1&&(n(0,"tr")(1,"th",30),u(2,"p-tableHeaderCheckbox"),o(),b(3,ke,3,0,"th",31),n(4,"th",32),a(5,"Nome "),u(6,"p-sortIcon",33),o(),n(7,"th",34),a(8,"Valor "),u(9,"p-sortIcon",33),o(),n(10,"th",35),a(11,"Clientes "),u(12,"p-sortIcon",36),o(),u(13,"th"),o()),i&2&&(p(3),d("ngIf",!1))}function Ie(i,_){if(i&1&&(n(0,"td")(1,"span",42),a(2,"Id"),o(),a(3),o()),i&2){let t=f().$implicit;p(3),M(" ",t.id," ")}}function Oe(i,_){if(i&1){let t=v();n(0,"tr",39)(1,"td"),u(2,"p-tableCheckbox",40),o(),b(3,Ie,4,1,"td",29),n(4,"td",41),g("click",function(){let e=c(t).$implicit,s=f();return m(s.abrirDialogAlterar(e))}),n(5,"span",42),a(6,"Nome"),o(),a(7),o(),n(8,"td",41),g("click",function(){let e=c(t).$implicit,s=f();return m(s.abrirDialogAlterar(e))}),n(9,"span",42),a(10,"Valor"),o(),a(11),o(),n(12,"td",43),g("click",function(){let e=c(t).$implicit,s=f();return m(s.abrirDialogAlterar(e))}),n(13,"span",42),a(14,"Clientes"),o(),n(15,"span",44),a(16),o()(),n(17,"td")(18,"div",45)(19,"button",46),g("click",function(){c(t);let e=f();return m(e.abrirDialogExcluirSelecionados())}),o()()()()}if(i&2){let t=_.$implicit,l=f();p(2),d("value",t),p(),d("ngIf",!1),p(4),M(" ",t.nome," "),p(4),M(" ",t.valor," "),p(5),I(l.getNumeroClientes(t.id))}}function Fe(i,_){i&1&&(n(0,"small",47),a(1,"O nome \xE9 obrigat\xF3rio."),o())}function Re(i,_){i&1&&(n(0,"small",47),a(1,"O valor \xE9 obrigat\xF3rio."),o())}function Ne(i,_){if(i&1){let t=v();n(0,"button",48),g("click",function(){c(t);let e=f();return m(e.dialogoPlano=!1)}),o(),n(1,"button",49),g("click",function(){c(t);let e=f();return m(e.salvarOuAlterar())}),o()}}function Be(i,_){i&1&&(n(0,"span"),a(1,"Tem certeza que voc\xEA deseja excluir o plano selecionado?"),o())}function Ae(i,_){if(i&1&&(n(0,"span"),a(1,"Tem certeza que voc\xEA deseja excluir os "),n(2,"b"),a(3),o(),a(4," planos selecionados? Todos ser\xE3o exclu\xEDdos."),o()),i&2){let t=f();p(3),I(t.listaPlanosSelecionados.length)}}function De(i,_){if(i&1){let t=v();n(0,"button",50),g("click",function(){c(t);let e=f();return m(e.dialogoExcluirSelecionados=!1)}),o(),n(1,"button",51),g("click",function(){c(t);let e=f();return m(e.excluirSelecionados())}),o()}}var Pe=(()=>{class i{constructor(t,l,e){this.planoService=t,this.messageService=l,this.clienteService=e,this.listaPlanos=[],this.listaPlanosSelecionados=[],this.dialogoPlano=!1,this.dialogoExcluirSelecionados=!1,this.planoSelecionado={},this.cols=[],this.submitted=!1,this.clientesPorPlano={}}ngOnInit(){console.log("aqui"),this.cols=[{field:"id",header:"Id"},{field:"nome",header:"Nome"},{field:"valor",header:"Valor"},{field:"nrClientes",header:"Clientes"}],this.planoService.getAll().subscribe({next:t=>{this.listaPlanos=t,this.carregarContagemClientes()},error:t=>console.error(t),complete:()=>console.info("complete")})}salvarOuAlterar(){if(this.submitted=!0,!this.planoSelecionado.nome||this.planoSelecionado.nome.trim().length==0){this.messageService.add({severity:"error",summary:"Erro!",detail:"Insira um nome!",life:3e3});return}this.planoSelecionado.id?this.alterar():this.salvar()}salvar(){this.planoService.create(this.planoSelecionado).then(()=>{this.dialogoPlano=!1,this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Plano Criado!",life:3e3}),this.planoService.getAll().subscribe({next:t=>{this.listaPlanos=t,this.carregarContagemClientes()},error:t=>console.error(t),complete:()=>console.info("complete")})})}abrirDialogAlterar(t){this.planoSelecionado=R({},t),this.submitted=!1,this.dialogoPlano=!0}alterar(){this.planoService.update(this.planoSelecionado).then(()=>{this.dialogoPlano=!1,this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Alterado!",life:3e3}),this.planoService.getAll().subscribe({next:t=>{this.listaPlanos=t,this.carregarContagemClientes()},error:t=>console.error(t),complete:()=>console.info("complete")})})}onGlobalFilter(t,l){t.filterGlobal(l.target.value,"contains")}novo(){this.dialogoPlano=!0,this.planoSelecionado={}}abrirDialogExcluirSelecionados(){if(!this.listaPlanosSelecionados||this.listaPlanosSelecionados.length===0){this.messageService.add({severity:"warn",summary:"Aten\xE7\xE3o!",detail:"Por favor, selecione pelo menos um plano para excluir.",life:3e3});return}this.dialogoExcluirSelecionados=!0}carregarContagemClientes(){return k(this,null,function*(){this.clientesPorPlano={};for(let t of this.listaPlanos)if(t.id){let e=(yield this.clienteService.getByPlano(t.id)).docs.map(s=>s.data());this.clientesPorPlano[t.id]=e.length,t.nrClientes=e.length}this.listaPlanos=[...this.listaPlanos]})}getNumeroClientes(t){return t&&this.clientesPorPlano[t]||0}excluirSelecionados(){return k(this,null,function*(){if(this.listaPlanosSelecionados){let t=[];for(let l of this.listaPlanosSelecionados){let s=(yield this.clienteService.getByPlano(l.id||"")).docs.map(h=>h.data());s.length>0&&t.push({plano:l,clientes:s})}if(t.length>0){let l=`Os seguintes planos n\xE3o podem ser exclu\xEDdos pois est\xE3o sendo utilizados por clientes:
`;t.forEach(e=>{let s=e.clientes.map(h=>h.nome).join(", ");l+=`
\u2022 ${e.plano.nome}: ${s}`}),this.messageService.add({severity:"error",summary:"Erro ao excluir!",detail:l,life:8e3}),this.dialogoExcluirSelecionados=!1;return}this.listaPlanosSelecionados.forEach(l=>{this.planoService.delete(l.id||"")}),this.dialogoExcluirSelecionados=!1,this.listaPlanosSelecionados=[],this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Planos Exclu\xEDdos",life:3e3}),this.planoService.getAll().subscribe({next:l=>{this.listaPlanos=l,this.carregarContagemClientes()},error:l=>console.error(l),complete:()=>console.info("complete")})}})}static{this.\u0275fac=function(l){return new(l||i)(y($),y(T),y(Z))}}static{this.\u0275cmp=N({type:i,selectors:[["app-plano"]],standalone:!1,features:[A([T])],decls:40,vars:39,consts:[["dt",""],[1,"grid"],[1,"col-12"],[1,"card","p-0","overflow-hidden","border-none","shadow-2"],[1,"p-4","bg-primary","text-white","flex","align-items-center","justify-content-between"],[1,"flex","align-items-center","gap-3"],[1,"pi","pi-tag","text-3xl"],[1,"text-2xl","font-bold","m-0","text-white"],[1,"m-0","text-primary-100","opacity-80"],[1,"p-input-icon-right","w-full","md:w-20rem"],[1,"pi","pi-search","text-500"],["pInputText","","type","text","placeholder","Pesquisar planos...",1,"w-full","p-3","border-round-xl",3,"input"],[1,"p-4"],["styleClass","p-datatable-striped list-table planos-table","responsiveLayout","stack","currentPageReportTemplate","Mostrando {first} at\xE9 {last} de {totalRecords} registros","selectionMode","multiple","dataKey","id",3,"selectionChange","value","columns","rows","globalFilterFields","paginator","rowsPerPageOptions","showCurrentPageReport","selection","rowHover"],["pTemplate","header"],["pTemplate","body"],["pButton","","pRipple","","icon","pi pi-plus",1,"p-button-rounded","p-button-success","fab",3,"click"],[1,"p-fluid",3,"visibleChange","visible","breakpoints","header","modal"],[1,"grid","mt-2"],[1,"field","col-12"],["for","name",1,"font-bold","text-900"],["type","text","pInputText","","id","name","required","","autofocus","","placeholder","Ex: Mensal Premium",3,"ngModelChange","ngModel","ngClass"],["class","p-error block",4,"ngIf"],["for","valor",1,"font-bold","text-900"],["mode","currency","currency","BRL","locale","pt-BR","placeholder","R$ 0,00",3,"ngModelChange","ngModel","ngClass"],["pTemplate","footer"],["header","Confirmar Exclus\xE3o",3,"visibleChange","visible","modal","breakpoints"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],[2,"width","3rem"],["pSortableColumn","id",4,"ngIf"],["pSortableColumn","nome"],["field","nome"],["pSortableColumn","valor"],["pSortableColumn","nrClientes",2,"width","150px","min-width","150px"],["field","nrClientes"],["pSortableColumn","id"],["field","id"],[1,"cursor-pointer"],[3,"value"],[3,"click"],[1,"p-column-title"],[2,"width","150px","min-width","150px","text-align","center",3,"click"],[1,"badge"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-trash",1,"p-button-rounded","p-button-warning",3,"click"],[1,"p-error","block"],["pButton","","pRipple","","label","Cancelar","icon","pi pi-times",1,"p-button-text","p-button-secondary",3,"click"],["pButton","","pRipple","","label","Salvar Plano","icon","pi pi-check",1,"p-button-primary","border-round-lg",3,"click"],["pButton","","pRipple","","icon","pi pi-times","label","N\xE3o",1,"p-button-text",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Sim",1,"p-button-text",3,"click"]],template:function(l,e){if(l&1){let s=v();n(0,"div",1),u(1,"p-toast"),n(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),u(6,"i",6),n(7,"div")(8,"h1",7),a(9,"Gerenciar Planos"),o(),n(10,"p",8),a(11,"Cadastro e gest\xE3o de planos do sistema"),o()()(),n(12,"span",9),u(13,"i",10),n(14,"input",11),g("input",function(r){c(s);let we=B(17);return m(e.onGlobalFilter(we,r))}),o()()(),n(15,"div",12)(16,"p-table",13,0),P("selectionChange",function(r){return c(s),S(e.listaPlanosSelecionados,r)||(e.listaPlanosSelecionados=r),m(r)}),b(18,Ve,14,1,"ng-template",14)(19,Oe,20,5,"ng-template",15),o()()(),n(20,"button",16),g("click",function(){return c(s),m(e.novo())}),o(),n(21,"p-dialog",17),P("visibleChange",function(r){return c(s),S(e.dialogoPlano,r)||(e.dialogoPlano=r),m(r)}),n(22,"div",18)(23,"div",19)(24,"label",20),a(25,"Nome do Plano"),o(),n(26,"input",21),P("ngModelChange",function(r){return c(s),S(e.planoSelecionado.nome,r)||(e.planoSelecionado.nome=r),m(r)}),o(),b(27,Fe,2,0,"small",22),o(),n(28,"div",19)(29,"label",23),a(30,"Valor da Mensalidade"),o(),n(31,"p-inputNumber",24),P("ngModelChange",function(r){return c(s),S(e.planoSelecionado.valor,r)||(e.planoSelecionado.valor=r),m(r)}),o(),b(32,Re,2,0,"small",22),o()(),b(33,Ne,2,0,"ng-template",25),o(),n(34,"p-dialog",26),P("visibleChange",function(r){return c(s),S(e.dialogoExcluirSelecionados,r)||(e.dialogoExcluirSelecionados=r),m(r)}),n(35,"div",27),u(36,"i",28),b(37,Be,2,0,"span",29)(38,Ae,5,1,"span",29),o(),b(39,De,2,0,"ng-template",25),o()()()}l&2&&(p(16),d("value",e.listaPlanos)("columns",e.cols)("rows",10)("globalFilterFields",C(29,ye))("rows",10)("paginator",!0)("rowsPerPageOptions",C(30,Ee))("showCurrentPageReport",!0),x("selection",e.listaPlanosSelecionados),d("rowHover",!0),p(5),V(C(31,Ce)),x("visible",e.dialogoPlano),d("breakpoints",C(32,Me))("header",e.planoSelecionado.id?"Editar Plano":"Novo Plano")("modal",!0),p(5),x("ngModel",e.planoSelecionado.nome),d("ngClass",O(33,xe,e.submitted&&!e.planoSelecionado.nome)),p(),d("ngIf",e.submitted&&!e.planoSelecionado.nome),p(4),x("ngModel",e.planoSelecionado.valor),d("ngClass",O(35,xe,e.submitted&&!e.planoSelecionado.valor)),p(),d("ngIf",e.submitted&&!e.planoSelecionado.valor),p(2),V(C(37,Ce)),x("visible",e.dialogoExcluirSelecionados),d("modal",!0)("breakpoints",C(38,Te)),p(3),d("ngIf",e.listaPlanosSelecionados.length===1),p(),d("ngIf",e.listaPlanosSelecionados.length>1))},dependencies:[D,W,le,z,ae,re,se,pe,J,G,H,U,Q,L,_e,te,ne,me],styles:[".fab[_ngcontent-%COMP%]{position:fixed!important;z-index:1030!important;right:2rem!important;bottom:2rem!important;width:56px!important;height:56px!important;transition:all .3s cubic-bezier(.4,0,.2,1)!important;animation:_ngcontent-%COMP%_fadeInUp .4s ease-out}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.1) translateY(-2px)!important;box-shadow:0 8px 16px #0000004d!important}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.list-card[_ngcontent-%COMP%]{position:relative;padding-bottom:100px}@media (max-width: 768px){.fab[_ngcontent-%COMP%]{width:48px!important;height:48px!important;right:1rem!important;bottom:1rem!important;bottom:calc(1rem + env(safe-area-inset-bottom,0px))!important}.fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem!important}.list-card[_ngcontent-%COMP%]{padding-bottom:80px}}[_nghost-%COMP%]{position:relative;min-height:100vh}.badge[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border-radius:12px;padding:2px 8px;font-size:.875rem;font-weight:500;display:inline-block;min-width:24px;text-align:center}.bg-primary[_ngcontent-%COMP%]   .p-input-icon-right[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:#ffffff1a!important;border-color:#ffffff4d!important;color:#fff!important}.bg-primary[_ngcontent-%COMP%]   .p-input-icon-right[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#ffffffb3!important}.bg-primary[_ngcontent-%COMP%]   .p-input-icon-right[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{background-color:#ffffff26!important;border-color:#ffffff80!important;box-shadow:0 0 0 2px #ffffff4d!important}.bg-primary[_ngcontent-%COMP%]   .p-input-icon-right[_ngcontent-%COMP%]   .pi-search[_ngcontent-%COMP%]{color:#ffffffb3!important}"]})}}return i})();var ve=(()=>{class i{static{this.\u0275fac=function(l){return new(l||i)}}static{this.\u0275mod=E({type:i})}static{this.\u0275inj=w({imports:[F.forChild([{path:"",component:Pe}]),F]})}}return i})();var St=(()=>{class i{static{this.\u0275fac=function(l){return new(l||i)}}static{this.\u0275mod=E({type:i})}static{this.\u0275inj=w({imports:[j,ve,ce,ue,Y,X,q,he,be,ge,ie,fe,ee,K,oe,de]})}}return i})();export{St as PlanoModule};
