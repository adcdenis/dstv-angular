import{a as we,b as _e}from"./chunk-TESYN4MF.js";import{a as xe,b as Fe}from"./chunk-YL7DZIPE.js";import{a as Se}from"./chunk-TYJRV2V5.js";import{a as ae}from"./chunk-AW5DFX2W.js";import{a as se}from"./chunk-ULMLR6ZN.js";import{b as ye}from"./chunk-6BD7PSS4.js";import{a as ne}from"./chunk-77VZTUG6.js";import{a as Ce,b as be}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import{a as fe,d as ge,e as ve,k as he}from"./chunk-C3W5HSCK.js";import"./chunk-5CO6IPWY.js";import{a as le,b as ce}from"./chunk-UNGKZQU4.js";import"./chunk-4RURM2DY.js";import"./chunk-UHPR5IVD.js";import"./chunk-T2PIK6R3.js";import"./chunk-7SPUUUGD.js";import"./chunk-SFTIWTHH.js";import{h as de,i as me}from"./chunk-VPFJ3TVV.js";import"./chunk-NJPLBFLS.js";import"./chunk-MDZH7E7N.js";import"./chunk-V6X5IB37.js";import"./chunk-V5XYQFDX.js";import"./chunk-3GJN2BSD.js";import"./chunk-UW4E5NSV.js";import"./chunk-6LXUGSQP.js";import{a as pe,b as ue}from"./chunk-RD2ZW53S.js";import"./chunk-UAXJ67OE.js";import{e as K,f as Q,h as U,i as X,j as Z,l as ee,m as te,n as oe}from"./chunk-ENZ5W56S.js";import"./chunk-S35HUXPS.js";import{b as ie,d as re}from"./chunk-4B2QLF32.js";import{g as T,k as N,p as J}from"./chunk-BFP4OEA6.js";import{Aa as k,Bb as H,F as b,Ka as a,L as y,La as x,M as S,N as A,Ra as $,Sa as L,Tb as B,Y as c,Z as C,da as R,ea as w,ja as O,la as I,ma as g,na as Y,rb as W,sa as n,ta as r,tb as q,u as P,ua as d,wb as z,ya as V,za as _}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{h as D}from"./chunk-MG3ERZGY.js";var Me=(()=>{class i{styleClass;style;strokeWidth="2";fill="none";animationDuration="2s";ariaLabel;static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["p-progressSpinner"]],hostAttrs:[1,"p-element"],inputs:{styleClass:"styleClass",style:"style",strokeWidth:"strokeWidth",fill:"fill",animationDuration:"animationDuration",ariaLabel:"ariaLabel"},standalone:!1,decls:3,vars:11,consts:[["role","progressbar",1,"p-progress-spinner",3,"ngStyle","ngClass"],["viewBox","25 25 50 50",1,"p-progress-spinner-svg"],["cx","50","cy","50","r","20","stroke-miterlimit","10",1,"p-progress-spinner-circle"]],template:function(t,o){t&1&&(n(0,"div",0),A(),n(1,"svg",1),d(2,"circle",2),r()()),t&2&&(g("ngStyle",o.style)("ngClass",o.styleClass),I("aria-label",o.ariaLabel)("aria-busy",!0)("data-pc-name","progressspinner")("data-pc-section","root"),c(),Y("animation-duration",o.animationDuration),I("data-pc-section","root"),c(),I("fill",o.fill)("stroke-width",o.strokeWidth))},dependencies:[W,z],styles:[`@layer primeng{.p-progress-spinner{position:relative;margin:0 auto;width:100px;height:100px;display:inline-block}.p-progress-spinner:before{content:"";display:block;padding-top:100%}.p-progress-spinner-svg{animation:p-progress-spinner-rotate 2s linear infinite;height:100%;transform-origin:center center;width:100%;position:absolute;inset:0;margin:auto}.p-progress-spinner-circle{stroke-dasharray:89,200;stroke-dashoffset:0;stroke:#d62d20;animation:p-progress-spinner-dash 1.5s ease-in-out infinite,p-progress-spinner-color 6s ease-in-out infinite;stroke-linecap:round}}@keyframes p-progress-spinner-rotate{to{transform:rotate(360deg)}}@keyframes p-progress-spinner-dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:89,200;stroke-dashoffset:-35px}to{stroke-dasharray:89,200;stroke-dashoffset:-124px}}@keyframes p-progress-spinner-color{to,0%{stroke:#d62d20}40%{stroke:#0057e7}66%{stroke:#008744}80%,90%{stroke:#ffa700}}
`],encapsulation:2,changeDetection:0})}return i})(),Ee=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=w({type:i});static \u0275inj=b({imports:[H]})}return i})();var ke=()=>[10,20,50],He=()=>["cliente.nome","plano.nome","servidor.nome"];function Te(i,F){i&1&&(n(0,"div",37),d(1,"p-progressSpinner",38),r())}function Ne(i,F){i&1&&(n(0,"tr")(1,"th",43),a(2,"Data/Hora Renova\xE7\xE3o "),d(3,"p-sortIcon",44),r(),n(4,"th",45),a(5,"Cliente "),d(6,"p-sortIcon",46),r(),n(7,"th",47),a(8,"Plano "),d(9,"p-sortIcon",48),r(),n(10,"th",49),a(11,"Servidor "),d(12,"p-sortIcon",50),r(),n(13,"th",51),a(14,"Novo Vencimento "),d(15,"p-sortIcon",52),r(),n(16,"th",53),a(17,"A\xE7\xF5es"),r()())}function Oe(i,F){if(i&1){let e=V();n(0,"tr")(1,"td"),a(2),r(),n(3,"td"),a(4),r(),n(5,"td"),a(6),r(),n(7,"td"),a(8),r(),n(9,"td"),a(10),r(),n(11,"td")(12,"button",54),_("click",function(){let o=y(e).$implicit,s=k(2);return S(s.confirmarExclusao(o))}),r()()()}if(i&2){let e=F.$implicit,t=k(2);c(2),x(t.formatarData(e.dataHoraRenovacao)),c(2),x((e.cliente==null?null:e.cliente.nome)||"-"),c(2),x((e.plano==null?null:e.plano.nome)||"-"),c(2),x((e.servidor==null?null:e.servidor.nome)||"-"),c(2),x(t.formatarDataSemHora(e.dataNovoVencimento))}}function Ve(i,F){i&1&&(n(0,"tr")(1,"td",55),a(2," Nenhum registro de renova\xE7\xE3o encontrado com os filtros selecionados. "),r()())}function Le(i,F){if(i&1&&(n(0,"p-table",39,1),O(2,Ne,18,0,"ng-template",40)(3,Oe,13,5,"ng-template",41)(4,Ve,3,0,"ng-template",42),r()),i&2){let e=k();g("value",e.listaHistorico)("columns",e.cols)("rows",10)("paginator",!0)("rowsPerPageOptions",L(9,ke))("showCurrentPageReport",!0)("globalFilterFields",L(10,He))("rowHover",!0)("sortOrder",-1)}}var De=(()=>{class i{constructor(e,t,o,s,p,u,v){this.historicoService=e,this.clienteService=t,this.planoService=o,this.servidorService=s,this.messageService=p,this.confirmationService=u,this.formBuilder=v,this.listaHistorico=[],this.listaClientes=[],this.clientesFiltrados=[],this.listaPlanos=[],this.listaServidores=[],this.isLoading=!0,this.filtroForm=this.formBuilder.group({cliente:[""],plano:[""],servidor:[""],dataInicio:[""],dataFim:[""]}),this.cols=[],this.converterDateToTimeStamp=h=>{let M=h.dataHoraRenovacao;if(M&&M.seconds){let l=new Date(M.seconds*1e3);h.dataHoraRenovacao=l}let m=h.dataNovoVencimento;if(m&&m.seconds){let l=new Date(m.seconds*1e3);h.dataNovoVencimento=l}return h}}ngOnInit(){this.cols=[{field:"dataHoraRenovacao",header:"Data/Hora Renova\xE7\xE3o"},{field:"cliente.nome",header:"Cliente"},{field:"plano.nome",header:"Plano"},{field:"servidor.nome",header:"Servidor"},{field:"dataNovoVencimento",header:"Novo Vencimento"}];let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),o=new Date(e.getFullYear(),e.getMonth()+1,0);this.filtroForm.patchValue({dataInicio:t,dataFim:o}),this.carregarDados()}formatDateForInput(e){let t=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0");return`${t}-${o}-${s}`}carregarDados(){return D(this,null,function*(){this.isLoading=!0;try{let[e,t,o]=yield Promise.all([this.clienteService.getAll().pipe(P(1)).toPromise(),this.planoService.getAll().pipe(P(1)).toPromise(),this.servidorService.getAll().pipe(P(1)).toPromise()]);this.listaClientes=e||[],this.listaPlanos=t||[],this.listaServidores=o||[],yield this.aplicarFiltros()}catch(e){console.error("Erro ao carregar dados:",e),this.messageService.add({severity:"error",summary:"Erro!",detail:"N\xE3o foi poss\xEDvel carregar os dados.",life:3e3})}finally{this.isLoading=!1}})}aplicarFiltros(){return D(this,null,function*(){this.isLoading=!0;try{let e=this.filtroForm.value,t=e.cliente,o=t&&typeof t=="object"?t.id:t,s=e.plano,p=e.servidor,u=e.dataInicio?e.dataInicio:void 0,v=e.dataFim?e.dataFim:void 0;v&&v.setHours(23,59,59,999);let h=yield this.historicoService.getByFiltros(o,s,p,u,v);if((o?1:0)+(s?1:0)+(p?1:0)+(u&&v?1:0)>1){let m=h.docs;o&&(m=m.filter(l=>{let f=l.data();return f.cliente&&f.cliente.id===o})),s&&(m=m.filter(l=>{let f=l.data();return f.plano&&f.plano.id===s})),p&&(m=m.filter(l=>{let f=l.data();return f.servidor&&f.servidor.id===p})),u&&v&&(m=m.filter(l=>{let E=l.data().dataHoraRenovacao;if(!E)return!1;let G=E.seconds?new Date(E.seconds*1e3):E;return G>=u&&G<=v})),this.listaHistorico=m.map(l=>{let f=l.data();return f.id=l.id,this.converterDateToTimeStamp(f)})}else this.listaHistorico=h.docs.map(m=>{let l=m.data();return l.id=m.id,this.converterDateToTimeStamp(l)})}catch(e){console.error("Erro ao aplicar filtros:",e),this.messageService.add({severity:"error",summary:"Erro!",detail:"N\xE3o foi poss\xEDvel aplicar os filtros.",life:3e3})}finally{this.isLoading=!1}})}limparFiltros(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),o=new Date(e.getFullYear(),e.getMonth()+1,0);this.filtroForm.patchValue({cliente:null,plano:"",servidor:"",dataInicio:t,dataFim:o}),this.clientesFiltrados=[],this.aplicarFiltros()}formatarData(e){if(!e)return"";let t=e;return t&&t.seconds&&(e=new Date(t.seconds*1e3)),e.toLocaleString("pt-BR")}formatarDataSemHora(e){if(!e)return"";let t=e;return t&&t.seconds&&(e=new Date(t.seconds*1e3)),e.toLocaleDateString("pt-BR")}onGlobalFilter(e,t){e.filterGlobal(t.target.value,"contains")}filtrarGlobalmente(e){if(!e||e.trim()===""){this.aplicarFiltros();return}let t=e.toLowerCase();this.listaHistorico=this.listaHistorico.filter(o=>{let s=o.cliente?.nome?.toLowerCase()||"",p=o.plano?.nome?.toLowerCase()||"",u=o.servidor?.nome?.toLowerCase()||"",v=this.formatarData(o.dataHoraRenovacao).toLowerCase(),h=this.formatarDataSemHora(o.dataNovoVencimento).toLowerCase();return s.includes(t)||p.includes(t)||u.includes(t)||v.includes(t)||h.includes(t)})}filtrarClientes(e){let t=e.query.toLowerCase();if(!t||t.length<3){this.clientesFiltrados=[];return}this.clientesFiltrados=this.listaClientes.filter(o=>o.nome&&o.nome.toLowerCase().includes(t))}confirmarExclusao(e){this.confirmationService.confirm({message:`Tem certeza que deseja excluir o registro de renova\xE7\xE3o do cliente "${e.cliente?.nome}"?`,header:"Confirma\xE7\xE3o de Exclus\xE3o",icon:"pi pi-exclamation-triangle",accept:()=>{this.excluirHistorico(e)}})}excluirHistorico(e){return D(this,null,function*(){try{if(!e.id){this.messageService.add({severity:"error",summary:"Erro!",detail:"ID do registro n\xE3o encontrado.",life:3e3});return}yield this.historicoService.delete(e.id),this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Registro exclu\xEDdo com sucesso.",life:3e3}),yield this.aplicarFiltros()}catch(t){console.error("Erro ao excluir hist\xF3rico:",t),this.messageService.add({severity:"error",summary:"Erro!",detail:"N\xE3o foi poss\xEDvel excluir o registro.",life:3e3})}})}static{this.\u0275fac=function(t){return new(t||i)(C(Se),C(ne),C(se),C(ae),C(N),C(T),C(ee))}}static{this.\u0275cmp=R({type:i,selectors:[["app-historico-renovacoes"]],standalone:!1,features:[$([N,T])],decls:52,vars:14,consts:[["globalFilter",""],["dt",""],[1,"grid"],[1,"col-12"],[1,"card","p-0","overflow-hidden","border-none","shadow-2"],[1,"p-4","bg-primary","text-white","flex","align-items-center","gap-3"],[1,"pi","pi-history","text-3xl"],[1,"text-2xl","font-bold","m-0","text-white"],[1,"m-0","text-primary-100","opacity-80"],[1,"p-4"],[1,"surface-ground","p-4","border-round-xl","mb-4"],[1,"text-900","font-bold","mb-4","flex","align-items-center","gap-2"],[1,"pi","pi-filter"],[1,"grid",3,"formGroup"],[1,"col-12","md:col-6","lg:col-4"],["for","dataInicio",1,"block","text-900","font-medium","mb-2"],["id","dataInicio","formControlName","dataInicio","dateFormat","dd/mm/yy","placeholder","Data in\xEDcio","appendTo","body",1,"w-full",3,"showIcon","showButtonBar"],["for","dataFim",1,"block","text-900","font-medium","mb-2"],["id","dataFim","formControlName","dataFim","dateFormat","dd/mm/yy","placeholder","Data fim","appendTo","body",1,"w-full",3,"showIcon","showButtonBar"],[1,"col-12","md:col-12","lg:col-4","flex","align-items-end"],[1,"flex","gap-2"],["pButton","","pRipple","","label","Filtrar","icon","pi pi-filter",1,"p-button-primary",3,"click"],["pButton","","pRipple","","label","Limpar","icon","pi pi-times",1,"p-button-secondary",3,"click"],["for","cliente",1,"block","text-900","font-medium","mb-2"],["id","cliente","formControlName","cliente","field","nome","placeholder","Digite pelo menos 3 caracteres","appendTo","body",1,"w-full",3,"completeMethod","suggestions","minLength","showClear"],["for","plano",1,"block","text-900","font-medium","mb-2"],["id","plano","formControlName","plano","optionLabel","nome","optionValue","id","placeholder","Todos os planos","appendTo","body",1,"w-full",3,"options","showClear"],["for","servidor",1,"block","text-900","font-medium","mb-2"],["id","servidor","formControlName","servidor","optionLabel","nome","optionValue","id","placeholder","Todos os servidores","appendTo","body",1,"w-full",3,"options","showClear"],[1,"card","shadow-1","border-round-xl"],[1,"flex","flex-column","md:flex-row","justify-content-between","align-items-center","mb-4","gap-3"],[1,"m-0","font-bold"],[1,"p-input-icon-right","md:w-20rem"],[1,"pi","pi-search","text-500"],["pInputText","","type","text","placeholder","Busca r\xE1pida...",1,"w-full","p-3","border-round-xl",3,"input"],["class","flex justify-content-center p-8",4,"ngIf"],["styleClass","p-datatable-sm p-datatable-gridlines","responsiveLayout","stack","currentPageReportTemplate","Exibindo {first} a {last} de {totalRecords}","sortField","dataHoraRenovacao",3,"value","columns","rows","paginator","rowsPerPageOptions","showCurrentPageReport","globalFilterFields","rowHover","sortOrder",4,"ngIf"],[1,"flex","justify-content-center","p-8"],["styleClass","w-4rem h-4rem","strokeWidth","4"],["styleClass","p-datatable-sm p-datatable-gridlines","responsiveLayout","stack","currentPageReportTemplate","Exibindo {first} a {last} de {totalRecords}","sortField","dataHoraRenovacao",3,"value","columns","rows","paginator","rowsPerPageOptions","showCurrentPageReport","globalFilterFields","rowHover","sortOrder"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pSortableColumn","dataHoraRenovacao"],["field","dataHoraRenovacao"],["pSortableColumn","cliente.nome"],["field","cliente.nome"],["pSortableColumn","plano.nome"],["field","plano.nome"],["pSortableColumn","servidor.nome"],["field","servidor.nome"],["pSortableColumn","dataNovoVencimento"],["field","dataNovoVencimento"],[2,"width","8rem"],["pButton","","pRipple","","icon","pi pi-trash","title","Excluir",1,"p-button-rounded","p-button-danger","p-button-outlined","mr-2","mb-2",3,"click"],["colspan","6",1,"text-center"]],template:function(t,o){if(t&1){let s=V();n(0,"div",2),d(1,"p-toast")(2,"p-confirmDialog"),n(3,"div",3)(4,"div",4)(5,"div",5),d(6,"i",6),n(7,"div")(8,"h1",7),a(9,"Hist\xF3rico de Renova\xE7\xF5es"),r(),n(10,"p",8),a(11,"Rastreamento completo de transa\xE7\xF5es"),r()()(),n(12,"div",9)(13,"div",10)(14,"h6",11),d(15,"i",12),a(16," Filtros de Busca "),r(),n(17,"form",13)(18,"div",14)(19,"label",15),a(20,"Data In\xEDcio"),r(),d(21,"p-calendar",16),r(),n(22,"div",14)(23,"label",17),a(24,"Data Fim"),r(),d(25,"p-calendar",18),r(),n(26,"div",19)(27,"div",20)(28,"button",21),_("click",function(){return y(s),S(o.aplicarFiltros())}),r(),n(29,"button",22),_("click",function(){return y(s),S(o.limparFiltros())}),r()()(),n(30,"div",14)(31,"label",23),a(32,"Cliente"),r(),n(33,"p-autoComplete",24),_("completeMethod",function(u){return y(s),S(o.filtrarClientes(u))}),r()(),n(34,"div",14)(35,"label",25),a(36,"Plano"),r(),d(37,"p-dropdown",26),r(),n(38,"div",14)(39,"label",27),a(40,"Servidor"),r(),d(41,"p-dropdown",28),r()()(),n(42,"div",29)(43,"div",30)(44,"h5",31),a(45,"Registros de Renova\xE7\xE3o"),r(),n(46,"span",32),d(47,"i",33),n(48,"input",34,0),_("input",function(u){return y(s),S(o.filtrarGlobalmente(u.target.value))}),r()()(),O(50,Te,2,0,"div",35)(51,Le,5,11,"p-table",36),r()()()()()}t&2&&(c(17),g("formGroup",o.filtroForm),c(4),g("showIcon",!0)("showButtonBar",!0),c(4),g("showIcon",!0)("showButtonBar",!0),c(8),g("suggestions",o.clientesFiltrados)("minLength",3)("showClear",!0),c(4),g("options",o.listaPlanos)("showClear",!0),c(4),g("options",o.listaServidores)("showClear",!0),c(9),g("ngIf",o.isLoading),c(),g("ngIf",!o.isLoading))},dependencies:[q,U,K,Q,X,Z,fe,J,ge,ve,ie,pe,Ce,de,le,we,xe,Me],styles:[".list-card[_ngcontent-%COMP%]   .p-toolbar[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:6px}@media screen and (max-width: 768px){.list-card[_ngcontent-%COMP%]   .clientes-toolbar[_ngcontent-%COMP%]   .p-toolbar-group-left[_ngcontent-%COMP%], .list-card[_ngcontent-%COMP%]   .clientes-toolbar[_ngcontent-%COMP%]   .p-toolbar-group-right[_ngcontent-%COMP%]{width:100%;justify-content:center}}.list-card[_ngcontent-%COMP%]   .clientes-table[_ngcontent-%COMP%]   .p-datatable-tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{padding:.5rem .75rem}.list-card[_ngcontent-%COMP%]   .clientes-table[_ngcontent-%COMP%]   .p-datatable-thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%]{background-color:#f8f9fa;font-weight:600}.list-card[_ngcontent-%COMP%]   .p-dropdown-panel[_ngcontent-%COMP%], .list-card[_ngcontent-%COMP%]   .p-datepicker[_ngcontent-%COMP%], .list-card[_ngcontent-%COMP%]   .p-autocomplete-panel[_ngcontent-%COMP%]{z-index:1000!important}.fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}"]})}}return i})();var Be=[{path:"",component:De}],Pe=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=w({type:i})}static{this.\u0275inj=b({imports:[B.forChild(Be),B]})}}return i})();var _t=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=w({type:i})}static{this.\u0275inj=b({imports:[H,te,oe,Pe,he,ye,re,ue,be,me,ce,_e,Fe,Ee]})}}return i})();export{_t as HistoricoRenovacoesModule};
