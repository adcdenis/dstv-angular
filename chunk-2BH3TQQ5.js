import{a as $}from"./chunk-U6KA5TMW.js";import{a as ce,b as me}from"./chunk-YOAYV4RA.js";import"./chunk-2JY635KS.js";import{b as Se}from"./chunk-6BD7PSS4.js";import{b as pe}from"./chunk-5WWM3MYI.js";import"./chunk-WSDER2HD.js";import"./chunk-T6OX34SV.js";import{b as ve}from"./chunk-MSYTDTXD.js";import{b as K}from"./chunk-4CYYGYMS.js";import{a as Z}from"./chunk-TYLBSFVV.js";import{a as ge,b as fe}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import{b as ue}from"./chunk-W22XDKEB.js";import"./chunk-4JDA26ZU.js";import{a as re,d as ne,e as le,h as se,i as ae,k as de}from"./chunk-ION2EUQK.js";import"./chunk-XCSSQDET.js";import"./chunk-V5XYQFDX.js";import"./chunk-MZURXKLX.js";import"./chunk-3AW6TXZQ.js";import{c as oe}from"./chunk-LJGI4ZRP.js";import"./chunk-T2PIK6R3.js";import"./chunk-SFTIWTHH.js";import"./chunk-7SPUUUGD.js";import{i as ee}from"./chunk-WSIWJYJX.js";import"./chunk-NJPLBFLS.js";import"./chunk-MDZH7E7N.js";import"./chunk-V6X5IB37.js";import"./chunk-3GJN2BSD.js";import"./chunk-MBI4S36B.js";import"./chunk-6LXUGSQP.js";import{a as te,b as ie}from"./chunk-UGHG6TU3.js";import"./chunk-UAXJ67OE.js";import{b as G,e as H,g as Q,k as U,n as Y}from"./chunk-KLIUDW4T.js";import"./chunk-S35HUXPS.js";import{b as J,d as X}from"./chunk-4B2QLF32.js";import{k as T,p as z,s as q,t as L}from"./chunk-BFP4OEA6.js";import{Aa as S,Bb as W,F as y,Ja as N,Ka as s,L as c,La as P,M as m,Ma as V,Oa as x,Pa as C,Qa as w,Ra as B,Sa as _,Ta as D,Tb as F,Y as d,Z as E,da as R,ea as M,ja as h,ma as u,pa as I,rb as A,sa as n,ta as r,tb as j,ua as v,ya as b,za as f}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{a as O,h as k}from"./chunk-MG3ERZGY.js";var we=()=>["nome","id"],ye=()=>[10,20,30],he=()=>({width:"450px"}),_e=()=>({"960px":"50vw","640px":"90vw"}),Ee=i=>({"ng-invalid ng-dirty":i});function Me(i,g){if(i&1){let e=b();n(0,"div",23)(1,"h5",24),v(2,"i",25),s(3,"Gerenciar Servidores"),r(),n(4,"span",26),v(5,"i",27),n(6,"input",28),f("input",function(t){c(e);let l=S(),p=N(5);return m(l.onGlobalFilter(p,t))}),r()()()}}function Te(i,g){i&1&&(n(0,"th",35),s(1,"Id "),v(2,"p-sortIcon",36),r())}function ke(i,g){i&1&&(n(0,"tr")(1,"th",29),v(2,"p-tableHeaderCheckbox"),r(),h(3,Te,3,0,"th",30),n(4,"th",31),s(5,"Nome "),v(6,"p-sortIcon",32),r(),n(7,"th",33),s(8,"Clientes "),v(9,"p-sortIcon",34),r(),v(10,"th"),r()),i&2&&(d(3),u("ngIf",!1))}function Ie(i,g){if(i&1&&(n(0,"td")(1,"span",38),s(2,"Id"),r(),s(3),r()),i&2){let e=S().$implicit;d(3),V(" ",e.id," ")}}function Pe(i,g){if(i&1){let e=b();n(0,"tr")(1,"td"),v(2,"p-tableCheckbox",37),r(),h(3,Ie,4,1,"td",21),n(4,"td")(5,"span",38),s(6,"Nome"),r(),s(7),r(),n(8,"td",39)(9,"span",38),s(10,"Clientes"),r(),n(11,"span",40),s(12),r()(),n(13,"td")(14,"div",41)(15,"button",42),f("click",function(){let t=c(e).$implicit,l=S();return m(l.abrirDialogAlterar(t))}),r(),n(16,"button",43),f("click",function(){c(e);let t=S();return m(t.abrirDialogExcluirSelecionados())}),r()()()()}if(i&2){let e=g.$implicit,o=S();d(2),u("value",e),d(),u("ngIf",!1),d(4),V(" ",e.nome," "),d(5),P(o.getNumeroClientes(e.id))}}function Ve(i,g){i&1&&(n(0,"small",44),s(1,"Nome \xE9 obrigat\xF3rio."),r())}function Fe(i,g){i&1&&(n(0,"span"),s(1,"Tem certeza que voc\xEA deseja excluir o servidor selecionado?"),r())}function Oe(i,g){if(i&1&&(n(0,"span"),s(1,"Tem certeza que voc\xEA deseja excluir os "),n(2,"b"),s(3),r(),s(4," servidores selecionados? Todos ser\xE3o exclu\xEDdos."),r()),i&2){let e=S();d(3),P(e.listaServidoresSelecionados.length)}}function Re(i,g){if(i&1){let e=b();n(0,"button",45),f("click",function(){c(e);let t=S();return m(t.dialogoExcluirSelecionados=!1)}),r(),n(1,"button",46),f("click",function(){c(e);let t=S();return m(t.excluirSelecionados())}),r()}}var xe=(()=>{class i{constructor(e,o,t){this.servidorService=e,this.messageService=o,this.clienteService=t,this.listaServidores=[],this.listaServidoresSelecionados=[],this.dialogoServidor=!1,this.dialogoExcluirSelecionados=!1,this.servidorSelecionado={},this.cols=[],this.submitted=!1,this.clientesPorServidor={}}ngOnInit(){console.log("aqui"),this.cols=[{field:"id",header:"Id"},{field:"nome",header:"Nome"},{field:"nrClientes",header:"Clientes"}],this.servidorService.getAll().subscribe({next:e=>{this.listaServidores=e,this.carregarContagemClientes()},error:e=>console.error(e),complete:()=>console.info("complete")})}salvarOuAlterar(){if(this.submitted=!0,!this.servidorSelecionado.nome||this.servidorSelecionado.nome.trim().length==0){this.messageService.add({severity:"error",summary:"Erro!",detail:"Insira um nome!",life:3e3});return}this.servidorSelecionado.id?this.alterar():this.salvar()}salvar(){this.servidorService.create(this.servidorSelecionado).then(()=>{this.dialogoServidor=!1,this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Servidor Criado!",life:3e3}),this.servidorService.getAll().subscribe({next:e=>{this.listaServidores=e,this.carregarContagemClientes()},error:e=>console.error(e),complete:()=>console.info("complete")})})}abrirDialogAlterar(e){this.servidorSelecionado=O({},e),this.submitted=!1,this.dialogoServidor=!0}alterar(){this.servidorService.update(this.servidorSelecionado).then(()=>{this.dialogoServidor=!1,this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Servidor Alterado!",life:3e3}),this.servidorService.getAll().subscribe({next:e=>{this.listaServidores=e,this.carregarContagemClientes()},error:e=>console.error(e),complete:()=>console.info("complete")})})}onGlobalFilter(e,o){e.filterGlobal(o.target.value,"contains")}novo(){this.dialogoServidor=!0,this.servidorSelecionado={}}abrirDialogExcluirSelecionados(){if(!this.listaServidoresSelecionados||this.listaServidoresSelecionados.length===0){this.messageService.add({severity:"warn",summary:"Aten\xE7\xE3o!",detail:"Por favor, selecione pelo menos um servidor para excluir.",life:3e3});return}this.dialogoExcluirSelecionados=!0}carregarContagemClientes(){return k(this,null,function*(){this.clientesPorServidor={};for(let e of this.listaServidores)if(e.id){let t=(yield this.clienteService.getByServidor(e.id)).docs.map(l=>l.data());this.clientesPorServidor[e.id]=t.length,e.nrClientes=t.length}this.listaServidores=[...this.listaServidores]})}getNumeroClientes(e){return e&&this.clientesPorServidor[e]||0}excluirSelecionados(){return k(this,null,function*(){if(this.listaServidoresSelecionados){let e=[];for(let o of this.listaServidoresSelecionados){let l=(yield this.clienteService.getByServidor(o.id||"")).docs.map(p=>p.data());l.length>0&&e.push({servidor:o,clientes:l})}if(e.length>0){let o=`Os seguintes servidores n\xE3o podem ser exclu\xEDdos pois est\xE3o sendo utilizados por clientes:
`;e.forEach(t=>{let l=t.clientes.map(p=>p.nome).join(", ");o+=`
\u2022 ${t.servidor.nome}: ${l}`}),this.messageService.add({severity:"error",summary:"Erro ao excluir!",detail:o,life:8e3}),this.dialogoExcluirSelecionados=!1;return}this.listaServidoresSelecionados.forEach(o=>{this.servidorService.delete(o.id||"")}),this.dialogoExcluirSelecionados=!1,this.listaServidoresSelecionados=[],this.messageService.add({severity:"success",summary:"Sucesso!",detail:"Servidores Exclu\xEDdos",life:3e3}),this.servidorService.getAll().subscribe({next:o=>{this.listaServidores=o,this.carregarContagemClientes()},error:o=>console.error(o),complete:()=>console.info("complete")})}})}static{this.\u0275fac=function(o){return new(o||i)(E($),E(T),E(Z))}}static{this.\u0275cmp=R({type:i,selectors:[["app-servidor"]],standalone:!1,features:[B([T])],decls:27,vars:33,consts:[["dt",""],[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6","fade-in","list-card"],["styleClass","p-datatable-striped list-table servidores-table","responsiveLayout","stack","currentPageReportTemplate","Mostrando {first} at\xE9 {last} de {totalRecords} registros","selectionMode","multiple","dataKey","id",3,"selectionChange","value","columns","rows","globalFilterFields","paginator","rowsPerPageOptions","showCurrentPageReport","selection","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pButton","","pRipple","","icon","pi pi-plus",1,"p-button-rounded","p-button-success","fab",3,"click"],["header","Detalhes do Servidor",1,"p-fluid",3,"visibleChange","visible","breakpoints","modal"],[1,"p-fluid","grid"],[1,"field","col-12"],["for","name"],["type","text","pInputText","","id","name","required","","autofocus","",3,"ngModelChange","ngModel","ngClass"],["class","ng-dirty ng-invalid",4,"ngIf"],[1,"field","col-6"],["pButton","","pRipple","","label","Cancelar","icon","pi pi-times",1,"p-button-danger",3,"click"],["pButton","","pRipple","","label","Salvar","icon","pi pi-check",1,"p-button-success",3,"click"],["header","Confirmar Exclus\xE3o",3,"visibleChange","visible","modal","breakpoints"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],[4,"ngIf"],["pTemplate","footer"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"m-0"],[1,"pi","pi-server","mr-2"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Procurar...",1,"w-full","sm:w-auto",3,"input"],[2,"width","3rem"],["pSortableColumn","id",4,"ngIf"],["pSortableColumn","nome"],["field","nome"],["pSortableColumn","nrClientes",2,"width","150px","min-width","150px"],["field","nrClientes"],["pSortableColumn","id"],["field","id"],[3,"value"],[1,"p-column-title"],[2,"width","150px","min-width","150px","text-align","center"],[1,"badge"],[1,"flex"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-rounded","p-button-success","mr-2",3,"click"],["pButton","","pRipple","","icon","pi pi-trash",1,"p-button-rounded","p-button-warning",3,"click"],[1,"ng-dirty","ng-invalid"],["pButton","","pRipple","","icon","pi pi-times","label","N\xE3o",1,"p-button-text",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Sim",1,"p-button-text",3,"click"]],template:function(o,t){if(o&1){let l=b();n(0,"div",1)(1,"div",2)(2,"div",3),v(3,"p-toast"),n(4,"p-table",4,0),w("selectionChange",function(a){return c(l),C(t.listaServidoresSelecionados,a)||(t.listaServidoresSelecionados=a),m(a)}),h(6,Me,7,0,"ng-template",5)(7,ke,11,1,"ng-template",6)(8,Pe,17,4,"ng-template",7),r()(),n(9,"button",8),f("click",function(){return c(l),m(t.novo())}),r(),n(10,"p-dialog",9),w("visibleChange",function(a){return c(l),C(t.dialogoServidor,a)||(t.dialogoServidor=a),m(a)}),n(11,"div",10)(12,"div",11)(13,"label",12),s(14,"Nome"),r(),n(15,"input",13),w("ngModelChange",function(a){return c(l),C(t.servidorSelecionado.nome,a)||(t.servidorSelecionado.nome=a),m(a)}),r(),h(16,Ve,2,0,"small",14),r(),n(17,"div",15)(18,"button",16),f("click",function(){return c(l),m(t.dialogoServidor=!1)}),r()(),n(19,"div",15)(20,"button",17),f("click",function(){return c(l),m(t.salvarOuAlterar())}),r()()()(),n(21,"p-dialog",18),w("visibleChange",function(a){return c(l),C(t.dialogoExcluirSelecionados,a)||(t.dialogoExcluirSelecionados=a),m(a)}),n(22,"div",19),v(23,"i",20),h(24,Fe,2,0,"span",21)(25,Oe,5,1,"span",21),r(),h(26,Re,2,0,"ng-template",22),r()()()}o&2&&(d(4),u("value",t.listaServidores)("columns",t.cols)("rows",10)("globalFilterFields",_(25,we))("rows",10)("paginator",!0)("rowsPerPageOptions",_(26,ye))("showCurrentPageReport",!0),x("selection",t.listaServidoresSelecionados),u("rowHover",!0),d(6),I(_(27,he)),x("visible",t.dialogoServidor),u("breakpoints",_(28,_e))("modal",!0),d(5),x("ngModel",t.servidorSelecionado.nome),u("ngClass",D(29,Ee,t.submitted&&!t.servidorSelecionado.nome)),d(),u("ngIf",t.submitted&&!t.servidorSelecionado.nome),d(5),I(_(31,he)),x("visible",t.dialogoExcluirSelecionados),u("modal",!0)("breakpoints",_(32,_e)),d(3),u("ngIf",t.listaServidoresSelecionados.length===1),d(),u("ngIf",t.listaServidoresSelecionados.length>1))},dependencies:[A,j,re,z,ne,le,se,ae,J,G,H,U,Q,q,ge,te,ce],styles:[".fab[_ngcontent-%COMP%]{position:fixed!important;z-index:1030!important;right:2rem!important;bottom:2rem!important;width:56px!important;height:56px!important;transition:all .3s cubic-bezier(.4,0,.2,1)!important;animation:_ngcontent-%COMP%_fadeInUp .4s ease-out}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.1) translateY(-2px)!important;box-shadow:0 8px 16px #0000004d!important}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.list-card[_ngcontent-%COMP%]{position:relative;padding-bottom:100px}@media (max-width: 768px){.fab[_ngcontent-%COMP%]{width:48px!important;height:48px!important;right:1rem!important;bottom:1rem!important;bottom:calc(1rem + env(safe-area-inset-bottom,0px))!important}.fab[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem!important}.list-card[_ngcontent-%COMP%]{padding-bottom:80px}}[_nghost-%COMP%]{position:relative;min-height:100vh}.badge[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border-radius:12px;padding:2px 8px;font-size:.875rem;font-weight:500;display:inline-block;min-width:24px;text-align:center}[_nghost-%COMP%]     .servidores-table th:nth-child(4), [_nghost-%COMP%]     .servidores-table td:nth-child(4){width:150px;min-width:150px;text-align:center}"]})}}return i})();var Ce=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=M({type:i})}static{this.\u0275inj=y({imports:[F.forChild([{path:"",component:xe}]),F]})}}return i})();var ft=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=M({type:i})}static{this.\u0275inj=y({imports:[W,Ce,de,pe,Y,X,L,fe,Se,ve,ie,ue,ee,K,oe,me]})}}return i})();export{ft as ServidorModule};
