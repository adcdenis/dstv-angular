import{a as ee,b as te}from"./chunk-NRZHTVWA.js";import{a as ie}from"./chunk-I6AVHS5N.js";import{a as pe}from"./chunk-ZG7MC6PH.js";import{a as H}from"./chunk-AW5DFX2W.js";import{a as K}from"./chunk-ULMLR6ZN.js";import{a as Q,b as W}from"./chunk-5WWM3MYI.js";import"./chunk-WSDER2HD.js";import"./chunk-T6OX34SV.js";import{a as Z}from"./chunk-77VZTUG6.js";import{a as X,b as Y}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import"./chunk-V5XYQFDX.js";import"./chunk-3GJN2BSD.js";import"./chunk-UW4E5NSV.js";import"./chunk-6LXUGSQP.js";import"./chunk-UAXJ67OE.js";import"./chunk-S35HUXPS.js";import{b as G,d as L}from"./chunk-4B2QLF32.js";import{k as b,s as $,t as q}from"./chunk-BFP4OEA6.js";import{Aa as z,Bb as U,Ea as f,F as g,Ka as t,La as B,Ra as V,Tb as j,Y as m,Z as u,da as k,ea as h,ja as R,m as A,ma as E,sa as e,ta as o,tb as P,u as c,ua as l,za as F}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{a as S,b as T,f as me,h as D}from"./chunk-MG3ERZGY.js";var re=me(pe());function de(r,ce){if(r&1&&(e(0,"div",33)(1,"span",34),l(2,"i",35),t(3," Resumo da Importa\xE7\xE3o "),o(),e(4,"div",36),l(5,"p-tag",37)(6,"p-tag",38)(7,"p-tag",39)(8,"p-tag",40),o()()),r&2){let i=z();m(5),f("value","Total: ",i.importSummary.total,""),m(),f("value","Novos: ",i.importSummary.novos,""),m(),f("value","Atualizados: ",i.importSummary.editados,""),m(),f("value","Erros: ",i.importSummary.invalidos,"")}}var ne=(()=>{class r{constructor(i,n,a,s){this.clienteService=i,this.planoService=n,this.servidorService=a,this.messageService=s,this.loading=!1,this.importing=!1,this.importSummary=null}toIsoDate(i){if(!i)return"";if(i instanceof Date)return i.toISOString();if(i.seconds)return new Date(i.seconds*1e3).toISOString();let n=new Date(i);return isNaN(n.getTime())?"":n.toISOString()}exportarJson(){this.loading=!0,A({clientes:this.clienteService.getAll().pipe(c(1)),planos:this.planoService.getAll().pipe(c(1)),servidores:this.servidorService.getAll().pipe(c(1))}).subscribe({next:i=>{let a={clientes:(i.clientes||[]).map(v=>T(S({},v),{dataVencimento:this.toIsoDate(v.dataVencimento)})),planos:i.planos||[],servidores:i.servidores||[]},s=JSON.stringify(a,null,2),d=new Blob([s],{type:"application/json"});re.saveAs(d,`dstv_export_${new Date().getTime()}.json`),this.messageService.add({severity:"success",summary:"Sucesso",detail:"Exporta\xE7\xE3o conclu\xEDda!"}),this.loading=!1},error:i=>{console.error(i),this.messageService.add({severity:"error",summary:"Erro",detail:"Falha ao exportar dados."}),this.loading=!1}})}importarJson(i){let n=i?.files?.[0]||i?.target?.files?.[0];if(!n)return;this.importing=!0;let a=new FileReader;a.onload=()=>D(this,null,function*(){try{let s=String(a.result||""),d=JSON.parse(s),v=Array.isArray(d?.clientes)?d.clientes:[],le=yield this.clienteService.getAll().pipe(c(1)).toPromise(),y=0,I=0,w=0,x=0,M=[];for(let p of v){let N=(p?.nome||"").trim(),_=p?.dataVencimento||"";if(!N||!_){x++;continue}y++;let J=new Date(_);if(isNaN(J.getTime())){x++;continue}let C=(le||[]).find(se=>(se.nome||"").trim()===N),O={nome:N,dataVencimento:J,usuario:p?.usuario||"",email:p?.email||"",telefone:p?.telefone||"",observacao:p?.observacao||"",servidor:p?.servidor||null,plano:p?.plano||null};C&&C.id?(M.push(this.clienteService.update(S(S({},C),O))),w++):(M.push(this.clienteService.create(O)),I++)}yield Promise.all(M),this.importSummary={total:y,novos:I,editados:w,invalidos:x},this.messageService.add({severity:"success",summary:"Importa\xE7\xE3o",detail:`Importados: ${y}, Novos: ${I}, Editados: ${w}, Inv\xE1lidos: ${x}`})}catch(s){console.error(s),this.messageService.add({severity:"error",summary:"Erro",detail:"JSON inv\xE1lido ou falha na importa\xE7\xE3o."})}finally{this.importing=!1}}),a.readAsText(n)}static{this.\u0275fac=function(n){return new(n||r)(u(Z),u(K),u(H),u(b))}}static{this.\u0275cmp=k({type:r,selectors:[["ng-component"]],standalone:!1,features:[V([b])],decls:81,vars:5,consts:[[1,"grid"],[1,"col-12"],[1,"card","p-0","overflow-hidden","border-none","shadow-2"],[1,"p-4","bg-primary","text-white","flex","align-items-center","gap-3"],[1,"pi","pi-sync","text-3xl"],[1,"text-2xl","font-bold","m-0","text-white"],[1,"m-0","text-primary-100","opacity-80"],[1,"p-4"],[1,"col-12","lg:col-6"],[1,"card","shadow-1","border-round-xl","h-full","border-top-3","border-green-500"],[1,"flex","align-items-center","gap-2","mb-4"],[1,"pi","pi-download","text-green-500","text-2xl"],[1,"m-0","font-bold","text-900"],[1,"text-700","line-height-3","mb-4"],[1,"font-bold","text-900"],[1,"text-primary","font-medium"],["pButton","","pRipple","","label","Baixar Backup (JSON)","icon","pi pi-file-export",1,"p-button-success","p-button-lg","w-full","border-round-lg",3,"click","loading"],[1,"card","shadow-1","border-round-xl","h-full","border-top-3","border-blue-500"],[1,"pi","pi-upload","text-blue-500","text-2xl"],["mode","basic","name","file","accept","application/json","chooseLabel","Selecionar Arquivo JSON","chooseIcon","pi pi-search","styleClass","p-button-primary p-button-lg w-full border-round-lg",3,"onSelect","maxFileSize","disabled"],["class","mt-4 surface-ground p-3 border-round-lg",4,"ngIf"],[1,"col-12","mt-4"],[1,"card","shadow-1","border-round-xl","surface-50"],[1,"text-900","font-bold","mb-4"],[1,"col-12","md:col-6"],[1,"list-none","p-0","m-0","text-700","line-height-4"],[1,"flex","align-items-start","gap-2"],[1,"pi","pi-check-circle","text-green-500","mt-1"],[1,"font-bold"],[1,"text-900","font-medium"],[1,"bg-surface-900","border-round-xl","p-3","shadow-4"],[1,"block","text-blue-300","font-mono","text-xs","mb-2","uppercase"],[1,"text-900","text-xs","m-0","line-height-2","overflow-auto",2,"max-height","150px"],[1,"mt-4","surface-ground","p-3","border-round-lg"],[1,"block","text-900","font-bold","mb-3","flex","align-items-center","gap-2"],[1,"pi","pi-info-circle","text-blue-500"],[1,"flex","flex-wrap","gap-2"],["severity","info","icon","pi pi-list",3,"value"],["severity","success","icon","pi pi-plus",3,"value"],["severity","warning","icon","pi pi-pencil",3,"value"],["severity","danger","icon","pi pi-times",3,"value"]],template:function(n,a){n&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),l(4,"i",4),e(5,"div")(6,"h1",5),t(7,"Sincroniza\xE7\xE3o de Dados"),o(),e(8,"p",6),t(9,"Exporta\xE7\xE3o e importa\xE7\xE3o da base de dados (JSON)"),o()()(),e(10,"div",7)(11,"div",0)(12,"div",8)(13,"div",9)(14,"div",10),l(15,"i",11),e(16,"h5",12),t(17,"Exportar Base Completa"),o()(),e(18,"p",13),t(19," Gera um arquivo "),e(20,"span",14),t(21,"JSON"),o(),t(22," contendo todos os "),e(23,"span",15),t(24,"Clientes"),o(),t(25,", "),e(26,"span",15),t(27,"Planos"),o(),t(28," e "),e(29,"span",15),t(30,"Servidores"),o(),t(31," cadastrados. Utilize este arquivo para backups ou migra\xE7\xE3o de dados. "),o(),e(32,"button",16),F("click",function(){return a.exportarJson()}),o()()(),e(33,"div",8)(34,"div",17)(35,"div",10),l(36,"i",18),e(37,"h5",12),t(38,"Restaurar / Importar"),o()(),e(39,"p",13),t(40," Selecione um arquivo "),e(41,"span",14),t(42,"JSON"),o(),t(43," exportado anteriormente para restaurar os dados. O sistema identificar\xE1 automaticamente registros novos e atualiza\xE7\xF5es. "),o(),e(44,"p-fileUpload",19),F("onSelect",function(d){return a.importarJson(d)}),o(),R(45,de,9,8,"div",20),o()(),e(46,"div",21)(47,"div",22)(48,"h5",23),t(49,"Especifica\xE7\xF5es do Formato"),o(),e(50,"div",0)(51,"div",24)(52,"ul",25)(53,"li",26),l(54,"i",27),e(55,"span"),t(56,"O campo "),e(57,"code",28),t(58,"nome"),o(),t(59," \xE9 a chave principal. Se j\xE1 existir, o registro ser\xE1 "),e(60,"span",29),t(61,"atualizado"),o(),t(62,"."),o()(),e(63,"li",26),l(64,"i",27),e(65,"span"),t(66,"A "),e(67,"code",28),t(68,"dataVencimento"),o(),t(69," deve seguir o padr\xE3o ISO (ex: 2025-12-31)."),o()(),e(70,"li",26),l(71,"i",27),e(72,"span"),t(73,"Campos de relacionamento (servidor/plano) podem ser nulos."),o()()()(),e(74,"div",24)(75,"div",30)(76,"span",31),t(77,"Exemplo de Estrutura"),o(),e(78,"pre",32),t(79),o()()()()()()()()()()(),l(80,"p-toast")),n&2&&(m(32),E("loading",a.loading),m(12),E("maxFileSize",5e6)("disabled",a.importing),m(),E("ngIf",a.importSummary),m(34),B(`{
  "clientes": [
    {
      "nome": "Jo\xE3o Silva",
      "dataVencimento": "2025-12-31T00:00:00Z",
      "usuario": "joao123",
      "email": "joao@email.com",
      "telefone": "55999999999"
    }
  ]
}`))},dependencies:[P,G,$,X,Q,ee],encapsulation:2})}}return r})();var ae=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=h({type:r})}static{this.\u0275inj=g({imports:[j.forChild([{path:"",component:ne}]),j]})}}return r})();var Ve=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=h({type:r})}static{this.\u0275inj=g({imports:[U,ae,L,q,ie,Y,W,te]})}}return r})();export{Ve as ExportModule};
