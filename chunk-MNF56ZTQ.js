import{a as Q}from"./chunk-I6AVHS5N.js";import{a as z,b as G}from"./chunk-QD3EWCKC.js";import{a as W}from"./chunk-U6KA5TMW.js";import{a as q}from"./chunk-FURQSZNK.js";import{a as U}from"./chunk-TYLBSFVV.js";import{b as K}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import{k as J}from"./chunk-KFGHBMQI.js";import"./chunk-MZURXKLX.js";import"./chunk-XCSSQDET.js";import"./chunk-V5XYQFDX.js";import"./chunk-3AW6TXZQ.js";import"./chunk-LJGI4ZRP.js";import"./chunk-T2PIK6R3.js";import"./chunk-SFTIWTHH.js";import"./chunk-7SPUUUGD.js";import"./chunk-WSIWJYJX.js";import"./chunk-NJPLBFLS.js";import"./chunk-MDZH7E7N.js";import"./chunk-V6X5IB37.js";import"./chunk-3GJN2BSD.js";import"./chunk-MBI4S36B.js";import"./chunk-6LXUGSQP.js";import"./chunk-UGHG6TU3.js";import"./chunk-UAXJ67OE.js";import{n as V}from"./chunk-KLIUDW4T.js";import"./chunk-S35HUXPS.js";import{d as $}from"./chunk-4B2QLF32.js";import"./chunk-BFP4OEA6.js";import{$a as F,Aa as E,Bb as H,F as b,Ka as s,La as C,Na as B,Tb as M,Y as l,Z as v,bb as I,da as R,ea as S,hb as N,ja as y,ma as d,sa as a,sb as P,ta as r,tb as O,ua as p,zb as k}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import"./chunk-MG3ERZGY.js";function re(e,m){e&1&&(a(0,"div",21),p(1,"i",22),r())}function ae(e,m){if(e&1&&p(0,"p-chart",23),e&2){let t=E();d("data",t.basicData)("options",t.basicOptions)}}function se(e,m){e&1&&(a(0,"div",21),p(1,"i",22),r())}function ce(e,m){if(e&1&&(a(0,"div",25)(1,"div",26)(2,"div",27)(3,"span",28),s(4),r(),a(5,"span",29),s(6),r()(),a(7,"div",30)(8,"span",31),s(9,"Lucro Previsto:"),r(),a(10,"span",32),s(11),F(12,"currency"),r()()()()),e&2){let t=m.$implicit;l(4),C(t.servidor.nome),l(2),B(" ",t.clientesAtivos," ",t.clientesAtivos===1?"cliente":"clientes"," "),l(5),C(I(12,4,t.lucro,"BRL"))}}function le(e,m){if(e&1&&(a(0,"div",0),y(1,ce,13,7,"div",24),r()),e&2){let t=E();l(),d("ngForOf",t.estatisticasServidor)}}function de(e,m){e&1&&(a(0,"div",33),s(1," Nenhum servidor com clientes ativos encontrado. "),r())}var Y=(()=>{class e{constructor(t,n,o,h){this.clienteService=t,this.planoService=n,this.servidorService=o,this.cdr=h,this.lucroTotal=0,this.isLoading=!0,this.clientes=[],this.planos=[],this.servidores=[],this.estatisticasServidor=[]}ngOnInit(){this.carregarDados()}carregarDados(){this.isLoading=!0,this.clienteService.getAll().subscribe(t=>{this.clientes=t||[],this.planoService.getAll().subscribe(n=>{this.planos=n||[],this.servidorService.getAll().subscribe(o=>{this.servidores=o||[],this.processarDados(this.clientes,this.planos,this.servidores),this.initChartOptions(),this.isLoading=!1,this.cdr.detectChanges()},o=>{console.error("Erro ao carregar servidores:",o),this.isLoading=!1,this.cdr.detectChanges()})},n=>{console.error("Erro ao carregar planos:",n),this.isLoading=!1,this.cdr.detectChanges()})},t=>{console.error("Erro ao carregar clientes:",t),this.isLoading=!1,this.cdr.detectChanges()})}processarDados(t,n,o){let h=new Map;n.forEach(i=>{i.id&&h.set(i.id,i)});let _=new Map;o.forEach(i=>{i.id&&_.set(i.id,i)});let g=new Map,x=new Map;o.forEach(i=>{i.id&&(g.set(i.id,0),x.set(i.id,0))}),this.lucroTotal=0;let L=new Date;L.setHours(0,0,0,0);let ee=0;t.forEach(i=>{let c=i.dataVencimento;if(c?.seconds&&(c=new Date(c.seconds*1e3)),c instanceof Date||(c=new Date(c)),c.setHours(0,0,0,0),c>=L){ee++;let u=i.plano?.id,f=i.servidor?.id;if(u&&f){let D=h.get(u),A=_.get(f);if(D&&A){let te=D.valor||0,ie=A.valorCredito||0,T=te-ie;this.lucroTotal+=T;let ne=g.get(f)||0;g.set(f,ne+T);let oe=x.get(f)||0;x.set(f,oe+1)}}}});let j=[],w=[];this.estatisticasServidor=[],o.forEach(i=>{if(i.id&&i.nome){let c=x.get(i.id)||0;if(c>0){j.push(i.nome);let u=g.get(i.id)||0;w.push(u),this.estatisticasServidor.push({servidor:i,lucro:u,clientesAtivos:c})}}}),this.basicData={labels:j,datasets:[{label:"Lucro por Servidor (R$)",data:w,backgroundColor:"#42A5F5",borderColor:"#1E88E5",borderWidth:1}]}}initChartOptions(){this.basicOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#495057"}},tooltip:{callbacks:{label:function(t){let n=t.dataset.label||"";return n&&(n+=": "),t.parsed.y!==null&&(n+=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.parsed.y)),n}}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057",callback:function(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)}},grid:{color:"#ebedef"}}}}}static{this.\u0275fac=function(n){return new(n||e)(v(U),v(q),v(W),v(N))}}static{this.\u0275cmp=R({type:e,selectors:[["app-financas"]],standalone:!1,decls:34,vars:9,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6","fade-in"],[1,"m-0","mb-4"],[1,"pi","pi-dollar","mr-2"],[1,"col-12","lg:col-8"],[1,"card"],["class","flex justify-content-center p-5",4,"ngIf"],["type","bar","height","400px",3,"data","options",4,"ngIf"],[1,"col-12","lg:col-4"],[1,"card","flex","flex-column","align-items-center","justify-content-center","h-full","bg-blue-50","surface-overlay","border-round","shadow-2"],[1,"flex","align-items-center","justify-content-center","bg-blue-100","border-circle","p-3","mb-3"],[1,"pi","pi-money-bill","text-5xl","text-blue-600"],[1,"text-xl","text-600","font-medium","mb-2"],[1,"text-4xl","font-bold","text-900"],[1,"text-sm","text-500","mt-3","text-center","px-3"],[1,"col-12","mt-4"],[1,"mb-4"],[1,"pi","pi-server","mr-2"],["class","grid",4,"ngIf"],["class","text-center text-500 p-4",4,"ngIf"],[1,"flex","justify-content-center","p-5"],[1,"pi","pi-spin","pi-spinner","text-4xl"],["type","bar","height","400px",3,"data","options"],["class","col-12 md:col-6 lg:col-4",4,"ngFor","ngForOf"],[1,"col-12","md:col-6","lg:col-4"],[1,"p-3","border-1","surface-border","border-round","surface-card"],[1,"flex","justify-content-between","align-items-center","mb-3"],[1,"text-xl","font-semibold","text-900"],[1,"bg-blue-100","text-blue-800","text-xs","font-bold","mr-2","px-2.5","py-0.5","rounded"],[1,"flex","justify-content-between","align-items-center"],[1,"text-600"],[1,"text-xl","font-bold","text-green-600"],[1,"text-center","text-500","p-4"]],template:function(n,o){n&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),p(4,"i",4),s(5,"Finan\xE7as - Lucro Previsto (M\xEAs Atual)"),r(),a(6,"div",0)(7,"div",5)(8,"div",6)(9,"h5"),s(10,"Lucro por Servidor"),r(),y(11,re,2,0,"div",7)(12,ae,1,2,"p-chart",8),r()(),a(13,"div",9)(14,"div",10)(15,"div",11),p(16,"i",12),r(),a(17,"span",13),s(18,"Lucro Total Previsto"),r(),a(19,"span",14),s(20),F(21,"currency"),r(),a(22,"span",15),s(23,"Baseado em clientes ativos"),p(24,"br"),s(25,"(vencimento a partir de hoje)"),r()()()(),a(26,"div",16)(27,"div",6)(28,"h5",17),p(29,"i",18),s(30,"Estat\xEDsticas por Servidor"),r(),y(31,se,2,0,"div",7)(32,le,2,1,"div",19)(33,de,2,0,"div",20),r()()()()()),n&2&&(l(11),d("ngIf",o.isLoading),l(),d("ngIf",!o.isLoading&&o.basicData),l(8),C(I(21,6,o.lucroTotal,"BRL")),l(11),d("ngIf",o.isLoading),l(),d("ngIf",!o.isLoading&&o.estatisticasServidor.length>0),l(),d("ngIf",!o.isLoading&&o.estatisticasServidor.length===0))},dependencies:[P,O,z,k],encapsulation:2})}}return e})();var pe=[{path:"",component:Y}],Z=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=S({type:e})}static{this.\u0275inj=b({imports:[M.forChild(pe),M]})}}return e})();var De=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=S({type:e})}static{this.\u0275inj=b({imports:[H,Z,V,G,Q,K,J,$]})}}return e})();export{De as FinancasModule};
