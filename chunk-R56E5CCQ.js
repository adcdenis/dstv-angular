import{a as ie,b as oe}from"./chunk-NRZHTVWA.js";import{a as de}from"./chunk-ZG7MC6PH.js";import{a as G}from"./chunk-LDGJCC3Y.js";import{a as te}from"./chunk-U6KA5TMW.js";import{a as ee}from"./chunk-FURQSZNK.js";import{a as K,b as W}from"./chunk-5WWM3MYI.js";import"./chunk-WSDER2HD.js";import"./chunk-T6OX34SV.js";import{a as X,b as Y}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import"./chunk-V5XYQFDX.js";import"./chunk-3GJN2BSD.js";import"./chunk-MBI4S36B.js";import"./chunk-6LXUGSQP.js";import"./chunk-UAXJ67OE.js";import{b as L,d as Z}from"./chunk-4B2QLF32.js";import"./chunk-S35HUXPS.js";import{k as C,q as z,s as U,t as H}from"./chunk-BFP4OEA6.js";import{Aa as j,Bb as _,Ea as h,F as c,Ka as i,La as P,Ra as B,Tb as O,Y as l,Z as u,da as N,ea as f,ja as w,m as q,ma as g,sa as a,ta as n,tb as $,u as v,ua as p,za as D}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{a as x,b as Q,f as pe,h as V}from"./chunk-MG3ERZGY.js";var ne=pe(de());function ce(t,ue){if(t&1&&(a(0,"div",11)(1,"strong"),i(2,"Resumo:"),n(),a(3,"div",12),p(4,"p-tag",13)(5,"p-tag",14)(6,"p-tag",15)(7,"p-tag",16),n()()),t&2){let e=j();l(4),h("value","Importados: ",e.importSummary.total,""),l(),h("value","Novos: ",e.importSummary.novos,""),l(),h("value","Editados: ",e.importSummary.editados,""),l(),h("value","Inv\xE1lidos: ",e.importSummary.invalidos,"")}}var ae=(()=>{class t{constructor(e,o,r,s){this.clienteService=e,this.planoService=o,this.servidorService=r,this.messageService=s,this.loading=!1,this.importing=!1,this.importSummary=null}toIsoDate(e){if(!e)return"";if(e instanceof Date)return e.toISOString();if(e.seconds)return new Date(e.seconds*1e3).toISOString();let o=new Date(e);return isNaN(o.getTime())?"":o.toISOString()}exportarJson(){this.loading=!0,q({clientes:this.clienteService.getAll().pipe(v(1)),planos:this.planoService.getAll().pipe(v(1)),servidores:this.servidorService.getAll().pipe(v(1))}).subscribe({next:e=>{let r={clientes:(e.clientes||[]).map(S=>Q(x({},S),{dataVencimento:this.toIsoDate(S.dataVencimento)})),planos:e.planos||[],servidores:e.servidores||[]},s=JSON.stringify(r,null,2),d=new Blob([s],{type:"application/json"});ne.saveAs(d,`dstv_export_${new Date().getTime()}.json`),this.messageService.add({severity:"success",summary:"Sucesso",detail:"Exporta\xE7\xE3o conclu\xEDda!"}),this.loading=!1},error:e=>{console.error(e),this.messageService.add({severity:"error",summary:"Erro",detail:"Falha ao exportar dados."}),this.loading=!1}})}importarJson(e){let o=e?.files?.[0]||e?.target?.files?.[0];if(!o)return;this.importing=!0;let r=new FileReader;r.onload=()=>V(this,null,function*(){try{let s=String(r.result||""),d=JSON.parse(s),S=Array.isArray(d?.clientes)?d.clientes:[],se=yield this.clienteService.getAll().pipe(v(1)).toPromise(),E=0,T=0,b=0,y=0,I=[];for(let m of S){let M=(m?.nome||"").trim(),R=m?.dataVencimento||"";if(!M||!R){y++;continue}E++;let k=new Date(R);if(isNaN(k.getTime())){y++;continue}let F=(se||[]).find(me=>(me.nome||"").trim()===M),A={nome:M,dataVencimento:k,usuario:m?.usuario||"",email:m?.email||"",telefone:m?.telefone||"",observacao:m?.observacao||"",servidor:m?.servidor||null,plano:m?.plano||null};F&&F.id?(I.push(this.clienteService.update(x(x({},F),A))),b++):(I.push(this.clienteService.create(A)),T++)}yield Promise.all(I),this.importSummary={total:E,novos:T,editados:b,invalidos:y},this.messageService.add({severity:"success",summary:"Importa\xE7\xE3o",detail:`Importados: ${E}, Novos: ${T}, Editados: ${b}, Inv\xE1lidos: ${y}`})}catch(s){console.error(s),this.messageService.add({severity:"error",summary:"Erro",detail:"JSON inv\xE1lido ou falha na importa\xE7\xE3o."})}finally{this.importing=!1}}),r.readAsText(o)}static{this.\u0275fac=function(o){return new(o||t)(u(G),u(ee),u(te),u(C))}}static{this.\u0275cmp=N({type:t,selectors:[["ng-component"]],standalone:!1,features:[B([C])],decls:47,vars:5,consts:[[1,"grid"],[1,"col-12","md:col-6"],[1,"card","fade-in"],[1,"pi","pi-download","mr-2"],["pButton","","pRipple","","label","Exportar JSON","icon","pi pi-download",1,"p-button-success","mr-2",3,"click","loading"],[1,"pi","pi-upload","mr-2"],["mode","basic","name","file","accept","application/json","chooseLabel","Selecionar JSON",3,"onSelect","maxFileSize","disabled"],["class","mt-3",4,"ngIf"],[1,"col-12"],[1,"card"],[1,"pre-wrap"],[1,"mt-3"],[1,"flex","gap-2","mt-2"],["severity","info",3,"value"],["severity","success",3,"value"],["severity","warning",3,"value"],["severity","danger",3,"value"]],template:function(o,r){o&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5"),p(4,"i",3),i(5,"Exportar Dados"),n(),a(6,"p"),i(7,"Clique no bot\xE3o abaixo para baixar um arquivo JSON contendo todos os Clientes, Planos e Servidores cadastrados."),n(),a(8,"button",4),D("click",function(){return r.exportarJson()}),n()()(),a(9,"div",1)(10,"div",2)(11,"h5"),p(12,"i",5),i(13,"Importar Dados"),n(),a(14,"p"),i(15,"Importe um arquivo JSON no mesmo formato do export."),n(),a(16,"p-fileUpload",6),D("onSelect",function(d){return r.importarJson(d)}),n(),w(17,ce,8,8,"div",7),n()(),a(18,"div",8)(19,"div",9)(20,"h5"),i(21,"Regras e Formato"),n(),a(22,"p"),i(23," - Campos obrigat\xF3rios em clientes: "),a(24,"code"),i(25,"nome"),n(),i(26," e "),a(27,"code"),i(28,"dataVencimento"),n(),i(29," (ISO)."),p(30,"br"),i(31," - Se o "),a(32,"code"),i(33,"nome"),n(),i(34," j\xE1 existir, o registro \xE9 atualizado; caso contr\xE1rio, \xE9 criado novo."),p(35,"br"),i(36," - "),a(37,"code"),i(38,"dataVencimento"),n(),i(39," \xE9 exportada e importada em ISO e convertida para o padr\xE3o do banco."),p(40,"br"),i(41," - Demais campos podem vir vazios. "),n(),a(42,"h6"),i(43,"Formato JSON"),n(),a(44,"pre",10),i(45),n()()()(),p(46,"p-toast")),o&2&&(l(8),g("loading",r.loading),l(8),g("maxFileSize",2e6)("disabled",r.importing),l(),g("ngIf",r.importSummary),l(28),P(`{
  "clientes": [
    {
      "nome": "Fulano",
      "dataVencimento": "2025-12-31T00:00:00.000Z",
      "usuario": "user1",
      "email": "fulano@exemplo.com",
      "telefone": "55999999999",
      "observacao": "",
      "servidor": null,
      "plano": null
    }
  ],
  "planos": [],
  "servidores": []
}`))},dependencies:[$,L,U,X,K,ie],encapsulation:2})}}return t})();var re=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=f({type:t})}static{this.\u0275inj=c({imports:[O.forChild([{path:"",component:ae}]),O]})}}return t})();var le=(()=>{class t{static \u0275fac=function(o){return new(o||t)};static \u0275mod=f({type:t});static \u0275inj=c({imports:[_,z]})}return t})();var ot=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=f({type:t})}static{this.\u0275inj=c({imports:[_,re,Z,H,le,Y,W,oe]})}}return t})();export{ot as ExportModule};
