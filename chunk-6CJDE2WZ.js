import{a as ee,b as te}from"./chunk-NRZHTVWA.js";import{a as ie}from"./chunk-I6AVHS5N.js";import{a as pe}from"./chunk-ZG7MC6PH.js";import{a as H}from"./chunk-AW5DFX2W.js";import{a as K}from"./chunk-ULMLR6ZN.js";import{a as Q,b as W}from"./chunk-5WWM3MYI.js";import"./chunk-WSDER2HD.js";import"./chunk-T6OX34SV.js";import{a as G}from"./chunk-77VZTUG6.js";import{a as X,b as Y}from"./chunk-DTX2IFH6.js";import"./chunk-3CQIXJFX.js";import"./chunk-4JDA26ZU.js";import"./chunk-V5XYQFDX.js";import"./chunk-3GJN2BSD.js";import"./chunk-UW4E5NSV.js";import"./chunk-6LXUGSQP.js";import"./chunk-UAXJ67OE.js";import"./chunk-S35HUXPS.js";import{b as L,d as Z}from"./chunk-4B2QLF32.js";import{k as y,s as U,t as q}from"./chunk-BFP4OEA6.js";import{Aa as k,Bb as B,Ea as v,F as x,Ka as t,La as P,Ra as $,Tb as _,Y as l,Z as u,da as A,ea as h,ja as V,m as R,ma as E,sa as n,ta as i,tb as z,u as c,ua as p,za as w}from"./chunk-UX7NIMCO.js";import"./chunk-EQC2ISW6.js";import"./chunk-YT5AF7SN.js";import{a as g,b as O,f as me,h as T}from"./chunk-MG3ERZGY.js";var re=me(pe());function de(o,ce){if(o&1&&(n(0,"div",11)(1,"strong"),t(2,"Resumo:"),i(),n(3,"div",12),p(4,"p-tag",13)(5,"p-tag",14)(6,"p-tag",15)(7,"p-tag",16),i()()),o&2){let e=k();l(4),v("value","Importados: ",e.importSummary.total,""),l(),v("value","Novos: ",e.importSummary.novos,""),l(),v("value","Editados: ",e.importSummary.editados,""),l(),v("value","Inv\xE1lidos: ",e.importSummary.invalidos,"")}}var ne=(()=>{class o{constructor(e,r,a,s){this.clienteService=e,this.planoService=r,this.servidorService=a,this.messageService=s,this.loading=!1,this.importing=!1,this.importSummary=null}toIsoDate(e){if(!e)return"";if(e instanceof Date)return e.toISOString();if(e.seconds)return new Date(e.seconds*1e3).toISOString();let r=new Date(e);return isNaN(r.getTime())?"":r.toISOString()}exportarJson(){this.loading=!0,R({clientes:this.clienteService.getAll().pipe(c(1)),planos:this.planoService.getAll().pipe(c(1)),servidores:this.servidorService.getAll().pipe(c(1))}).subscribe({next:e=>{let a={clientes:(e.clientes||[]).map(f=>O(g({},f),{dataVencimento:this.toIsoDate(f.dataVencimento)})),planos:e.planos||[],servidores:e.servidores||[]},s=JSON.stringify(a,null,2),d=new Blob([s],{type:"application/json"});re.saveAs(d,`dstv_export_${new Date().getTime()}.json`),this.messageService.add({severity:"success",summary:"Sucesso",detail:"Exporta\xE7\xE3o conclu\xEDda!"}),this.loading=!1},error:e=>{console.error(e),this.messageService.add({severity:"error",summary:"Erro",detail:"Falha ao exportar dados."}),this.loading=!1}})}importarJson(e){let r=e?.files?.[0]||e?.target?.files?.[0];if(!r)return;this.importing=!0;let a=new FileReader;a.onload=()=>T(this,null,function*(){try{let s=String(a.result||""),d=JSON.parse(s),f=Array.isArray(d?.clientes)?d.clientes:[],se=yield this.clienteService.getAll().pipe(c(1)).toPromise(),I=0,b=0,M=0,S=0,N=[];for(let m of f){let C=(m?.nome||"").trim(),D=m?.dataVencimento||"";if(!C||!D){S++;continue}I++;let j=new Date(D);if(isNaN(j.getTime())){S++;continue}let F=(se||[]).find(le=>(le.nome||"").trim()===C),J={nome:C,dataVencimento:j,usuario:m?.usuario||"",email:m?.email||"",telefone:m?.telefone||"",observacao:m?.observacao||"",servidor:m?.servidor||null,plano:m?.plano||null};F&&F.id?(N.push(this.clienteService.update(g(g({},F),J))),M++):(N.push(this.clienteService.create(J)),b++)}yield Promise.all(N),this.importSummary={total:I,novos:b,editados:M,invalidos:S},this.messageService.add({severity:"success",summary:"Importa\xE7\xE3o",detail:`Importados: ${I}, Novos: ${b}, Editados: ${M}, Inv\xE1lidos: ${S}`})}catch(s){console.error(s),this.messageService.add({severity:"error",summary:"Erro",detail:"JSON inv\xE1lido ou falha na importa\xE7\xE3o."})}finally{this.importing=!1}}),a.readAsText(r)}static{this.\u0275fac=function(r){return new(r||o)(u(G),u(K),u(H),u(y))}}static{this.\u0275cmp=A({type:o,selectors:[["ng-component"]],standalone:!1,features:[$([y])],decls:47,vars:5,consts:[[1,"grid"],[1,"col-12","md:col-6"],[1,"card","fade-in"],[1,"pi","pi-download","mr-2"],["pButton","","pRipple","","label","Exportar JSON","icon","pi pi-download",1,"p-button-success","mr-2",3,"click","loading"],[1,"pi","pi-upload","mr-2"],["mode","basic","name","file","accept","application/json","chooseLabel","Selecionar JSON",3,"onSelect","maxFileSize","disabled"],["class","mt-3",4,"ngIf"],[1,"col-12"],[1,"card"],[1,"pre-wrap"],[1,"mt-3"],[1,"flex","gap-2","mt-2"],["severity","info",3,"value"],["severity","success",3,"value"],["severity","warning",3,"value"],["severity","danger",3,"value"]],template:function(r,a){r&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5"),p(4,"i",3),t(5,"Exportar Dados"),i(),n(6,"p"),t(7,"Clique no bot\xE3o abaixo para baixar um arquivo JSON contendo todos os Clientes, Planos e Servidores cadastrados."),i(),n(8,"button",4),w("click",function(){return a.exportarJson()}),i()()(),n(9,"div",1)(10,"div",2)(11,"h5"),p(12,"i",5),t(13,"Importar Dados"),i(),n(14,"p"),t(15,"Importe um arquivo JSON no mesmo formato do export."),i(),n(16,"p-fileUpload",6),w("onSelect",function(d){return a.importarJson(d)}),i(),V(17,de,8,8,"div",7),i()(),n(18,"div",8)(19,"div",9)(20,"h5"),t(21,"Regras e Formato"),i(),n(22,"p"),t(23," - Campos obrigat\xF3rios em clientes: "),n(24,"code"),t(25,"nome"),i(),t(26," e "),n(27,"code"),t(28,"dataVencimento"),i(),t(29," (ISO)."),p(30,"br"),t(31," - Se o "),n(32,"code"),t(33,"nome"),i(),t(34," j\xE1 existir, o registro \xE9 atualizado; caso contr\xE1rio, \xE9 criado novo."),p(35,"br"),t(36," - "),n(37,"code"),t(38,"dataVencimento"),i(),t(39," \xE9 exportada e importada em ISO e convertida para o padr\xE3o do banco."),p(40,"br"),t(41," - Demais campos podem vir vazios. "),i(),n(42,"h6"),t(43,"Formato JSON"),i(),n(44,"pre",10),t(45),i()()()(),p(46,"p-toast")),r&2&&(l(8),E("loading",a.loading),l(8),E("maxFileSize",2e6)("disabled",a.importing),l(),E("ngIf",a.importSummary),l(28),P(`{
  "clientes": [
    {
      "nome": "Fulano",
      "dataVencimento": "2025-12-31T00:00:00.000Z",
      "usuario": "user1",
      "email": "fulano@exemplo.com",
      "telefone": "55999999999",
      "observacao": "",
      "servidor": null,
      "plano": null
    }
  ],
  "planos": [],
  "servidores": []
}`))},dependencies:[z,L,U,X,Q,ee],encapsulation:2})}}return o})();var ae=(()=>{class o{static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275mod=h({type:o})}static{this.\u0275inj=x({imports:[_.forChild([{path:"",component:ne}]),_]})}}return o})();var $e=(()=>{class o{static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275mod=h({type:o})}static{this.\u0275inj=x({imports:[B,ae,Z,q,ie,Y,W,te]})}}return o})();export{$e as ExportModule};
